(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{105:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(62),i=a(41),s=a(26),o=a(5),l=a(6),u=a(12),d=a(10),m=a(13),h=a(4),v=a(17),p=a.n(v),f="NAVIGATE_PAGE",E="SERVER_NOTIFICATION",y="SERVER_ERROR",b="SERVER_DISCONNECT",g="SERVER_FORCE_DISCONNECT",N=Object(h.b)(function(e){return{}},function(){return{}})(function(e){var t=e.href,a=e.classNameInput,n=e.children,c=e.onClick,i=function(e){c?c(e):t&&(window.location.href=t)},s="silentLink "+a;return r.a.createElement("a",{onClick:function(e){return i(e)},className:s},n)}),I=Object(h.b)(function(e){var t=p.a.get("userName"),a=p.a.get("roles");return{roles:a?a.split("|"):[],userName:t,currentPage:e.currentPage}},function(e){return{navigateTo:function(t,a,n){return t.preventDefault(),console.log("Navigating to page: "+a),e({type:f,to:a,from:n}),!1}}})(function(e){var t=e.roles,a=(e.userName,e.currentPage),n=e.requriesRole,c=e.targetPage,i=e.label,s=e.navigateTo;return t.includes(n)?a===c?r.a.createElement("li",{className:"active"},r.a.createElement(N,{onClick:function(e){e.preventDefault()}},i)):r.a.createElement("li",null,r.a.createElement(N,{onClick:function(e){return s(e,c,a)}},i)):r.a.createElement("span",null,i," ")}),O="GM_SITES",k="HACKER_HOME",w="SCAN",S=Object(h.b)(function(e){return{userName:p.a.get("userName"),currentPage:e.currentPage}},function(e){return{}})(function(e){var t=e.userName,a=e.currentPage;return r.a.createElement("div",{className:"navbar navbar-inverse navbar-fixed-bottom"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"navbar-header"},r.a.createElement("button",{type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":".nav-collapse"},r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"})),r.a.createElement("a",{className:"navbar-brand"},"\u21bc Attack Vector \u21c1")),r.a.createElement("div",{className:"navbar-collapse collapse"},r.a.createElement("ul",{className:"nav navbar-nav"},r.a.createElement(I,{requriesRole:"ROLE_HACKER",targetPage:k,label:"Home"}),function(e){return e===w?r.a.createElement(I,{requriesRole:"ROLE_HACKER",targetPage:w,label:"Scan"}):r.a.createElement("span",null)}(a),r.a.createElement(I,{requriesRole:"ROLE_SITE_MANAGER",targetPage:O,label:"Sites"}),r.a.createElement(I,{requriesRole:"ROLE_LOGS",targetPage:"LOGS",label:"Logs"}),r.a.createElement(I,{requriesRole:"ROLE_MISSION_MANAGER",targetPage:"MISSIONS",label:"Missions"}),r.a.createElement(I,{requriesRole:"ROLE_USER_MANAGER",targetPage:"USERS",label:"Users"}),r.a.createElement(I,{requriesRole:"ROLE_ADMIN",targetPage:"ADMIN",label:"Admin"}),r.a.createElement(I,{requriesRole:"ROLE_HACKER_MANAGER",targetPage:"HACKER_COMMUNITY",label:"Hacker Community"})),r.a.createElement("ul",{className:"nav navbar-nav navbar-right"},r.a.createElement(I,{requriesRole:"ROLE_USER",targetPage:"ME",label:"{"+t+"}"}),r.a.createElement("li",null,r.a.createElement("a",{href:"/login",onClick:function(e){return function(e){e.preventDefault(),p.a.remove("jwt"),p.a.remove("type"),p.a.remove("roles"),p.a.remove("userName"),document.location.href="/login"}(e)}},"\ua57b Logout"))))))}),x=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={value:""},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({value:e.value})}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleKeyDown",value:function(e){13===e.keyCode&&this.props.save(this.state.value)}},{key:"save",value:function(){this.props.save(this.state.value),this.props.clearAfterSubmit&&this.setState({value:""})}},{key:"render",value:function(){var e=this,t=this.props,a=t.placeholder,n=t.buttonLabel,c="btn "+t.buttonClass,i=this.state.value;return r.a.createElement("div",{className:"form-inline"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",placeholder:a,value:i,onChange:function(t){return e.handleChange(t)},onKeyDown:function(t){return e.handleKeyDown(t)}})),r.a.createElement("button",{type:"button",className:c,onClick:function(){return e.save()}},n))}}]),t}(n.Component),_=function(e){var t=e.url,a=e.body,n=e.ok,r=e.notok,c=e.error;fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(e){e.ok?e.text().then(function(t){if(t&&(t.startsWith("{")||t.startsWith("["))){var a=JSON.parse(t);n(a)}else console.log("Response was empty or not a JSON object: '"+t+"'"),r(e)}):r?r(e):console.log("Post request failed to '"+t+"' but no not-ok handling supplied.")}).catch(function(e){c?c(e):r?r(e):(console.log("Post request failed to '"+t+"' but no error or not-ok handling supplied."),console.log(e))})},j=a(75),C=function(e,t){j.show({title:e,message:t,position:"topCenter",color:"yellow"})},D=function(e){j.show({title:"Fatal",message:e,position:"topCenter",color:"red",timeout:!1})},R=function(e){var t=e.type,a=e.title,n=e.message;"ok_right"===t?function(e,t,a){j.show({title:e,message:t,position:a,color:"green"})}(a,n,"topRight"):"advice_right"===t?function(e,t,a){j.show({title:e,message:t,position:a,color:"green",timeout:!1})}(a,n,"topRight"):"advice_left"===t?C(a,n):"neutral"===t?C(a,n):"error"===t?function(e,t){j.show({title:e,message:t,position:"topCenter",color:"blue"})}(a,n):D(a+" "+n)},L=function(e){_({url:"/api/site/",body:{},ok:function(t){e({type:"RECEIVE_SITES",sites:t})},notok:function(){D("Failed to receive site list from server.")}})},A=Object(h.b)(function(e){return{sites:e.sites}},function(e){return{edit:function(t){_({url:"/api/site/edit",body:{siteName:t},ok:function(t){var a=t.id;window.open("/edit/"+a),L(e)},notok:function(){D("Connection to server failed, unable to continue.")}})}}})(function(e){var t=e.sites,a=e.edit;return document.body.style.backgroundColor="#222222",r.a.createElement("span",null,r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-2"},r.a.createElement("span",{className:"text"},"\xa0")),r.a.createElement("div",{className:"col-lg-5 backgroundLight"},r.a.createElement("span",{className:"text"},"\xa0")),r.a.createElement("div",{className:"col-lg-5 rightPane"},r.a.createElement("span",{className:"text"},"Site map"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-2"}),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("div",{className:"text"},r.a.createElement("strong",null,"\ud83d\udf01ttack \ud83d\udf03ector"),r.a.createElement("br",null),r.a.createElement("br",null),"Frontier Hacking GM Interface",r.a.createElement("br",null),r.a.createElement("br",null),"Enter a site name and click one of the buttons.",r.a.createElement("br",null),"The site does not have to exist yet.",r.a.createElement("br",null),r.a.createElement("br",null),"Actions",r.a.createElement("br",null),r.a.createElement("br",null),"\ud83c\udf10 - print site scan",r.a.createElement("br",null),"\ud83d\udca0 - print SL version site scan",r.a.createElement("br",null),"\ud83d\udfae - deactivate site",r.a.createElement("br",null),"\ud83d\udcab - reactivate site",r.a.createElement("br",null)),r.a.createElement("div",{id:"actions"},r.a.createElement("div",{className:"text"},r.a.createElement(x,{placeholder:"Site name",buttonLabel:"Create or edit",buttonClass:"btn-info",save:function(e){return a(e)},clearAfterSubmit:"true"})))),r.a.createElement("div",{className:"col-lg-5 rightPane rightPane"},r.a.createElement("div",{className:"siteMap rightPaneDimensions"},r.a.createElement("div",null,"\xa0"),r.a.createElement("div",{className:"rightPanePadLeftRight"},r.a.createElement("table",{className:"table table-condensed text-muted text",id:"sitesTable"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"text-strong"},"Name"))),r.a.createElement("tbody",null,t.map(function(e){return r.a.createElement("tr",{key:"1"},r.a.createElement("td",{className:"table-very-condensed"},r.a.createElement("a",{target:e.id,href:"/edit/"+e.id},e.name)))})))))))),r.a.createElement(S,null))}),T=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).props=e;var n=void 0!==p.a.get("jwt"),r=[],c=p.a.get("roles");return c&&(r=c.split("|")),a.state={authenticated:n,roles:r},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){if(this.state.authenticated)return this.state.roles.includes(this.props.requires)?r.a.createElement("div",null,this.props.children):r.a.createElement("div",{className:"text"},"You are not logged in with an account that has access to this page. Please ",r.a.createElement("a",{href:"/login"},"Login")," with another account.",r.a.createElement("br",null),r.a.createElement("br",null),"Required role: ",this.props.requires);document.location.href="/login?next=".concat(document.location.href)}}]),t}(n.Component),P=a(15),B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No page yet.",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return t.to;default:return e}},M=[],F=function(e){return e.sites},V=Object(P.c)({currentPage:B,sites:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SITES":return F(t);default:return e}}}),H=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).store=Object(P.e)(V,{currentPage:O}),L(a.store.dispatch),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"renderIfAuthenticated",value:function(){return r.a.createElement(h.a,{store:this.store},r.a.createElement(A,null))}},{key:"render",value:function(){return r.a.createElement(T,{requires:"ROLE_SITE_MANAGER"},this.renderIfAuthenticated())}}]),t}(n.Component),U=a(8),z=a(42),W={name:"transit_1",dir:"reg"},K={name:"transit_2",dir:"reg"},G={name:"transit_3",dir:"reg"},q={name:"transit_4",dir:"reg"},Y={name:"syscon",dir:"reg"},J={name:"data_store",dir:"reg"},X={name:"passcode_store",dir:"reg"},Q={name:"resource_store",dir:"reg"},Z={name:"ice_1",dir:"ice"},$={name:"ice_2",dir:"ice"},ee={name:"ice_3",dir:"ice"},te={name:"unhackable",dir:"ice"},ae={name:"manual_1",dir:"ice"},ne={name:"manual_2",dir:"ice"},re={name:"manual_3",dir:"ice"},ce={TRANSIT_1:W,TRANSIT_2:K,TRANSIT_3:G,TRANSIT_4:q,SYSCON:Y,DATA_STORE:J,PASSCODE_STORE:X,RESOURCE_STORE:Q,ICE_1:Z,ICE_2:$,ICE_3:ee,UNHACKABLE:te,MANUAL_1:ae,MANUAL_2:ne,MANUAL_3:re},ie="REQUEST_SITE_FULL",se="SERVER_SITE_FULL",oe="EDIT_SITE_DATA",le="DRAG_DROP_END",ue="SERVER_ADD_NODE",de="MOVE_NODE",me="SERVER_MOVE_NODE",he="ADD_CONNECTION",ve="SERVER_ADD_CONNECTION",pe="DELETE_CONNECTIONS",fe="DELETE_NODE",Ee="SNAP",ye="EDIT_NETWORK_ID",be="EDIT_SERVICE_DATA",ge="ADD_SERVICE",Ne="REMOVE_SERVICE",Ie="SWAP_SERVICE_LAYER",Oe=Object(h.b)(function(e){return{theme:e.theme}},function(e){return{dispatch:e}})(function(e){var t=e.dispatch,a=e.theme,n=e.type,c=e.ice,i=e.title,s=e.onLoad,o=function(e){var a=e.nativeEvent,r=a.offsetX,i=a.offsetY,s=a.target.width/2,o=a.target.height/2;t({type:"DRAG_START",data:{type:n,dx:r-s,dy:i-o,ice:c}})},l=n.dir+"/"+n.name+".png",u="/img/"+a+"/nodes/run/",d=u+"free/"+l,m=u+"protected/"+l,h=n.name+"_FREE",v=n.name+"_PROTECTED";return c?r.a.createElement("span",null,r.a.createElement("img",{style:{display:"none"},src:d,height:"80",width:"80",id:h}),r.a.createElement("img",{style:{display:"inline"},src:m,height:"80",width:"80",id:v,title:i,onDragStart:function(e){return o(e)},onLoad:function(){return s()}})):r.a.createElement("span",null,r.a.createElement("img",{style:{display:"inline"},src:d,height:"80",width:"80",id:h,title:i,onDragStart:function(e){return o(e)},onLoad:function(){return s()}}),r.a.createElement("img",{style:{display:"none"},src:m,height:"80",width:"80",id:v}))}),ke=a(14),we=a(64),Se=a.n(we),xe="TERMINAL_SUBMIT",_e="TERMINAL_RECEIVE",je="TERMINAL_CLEAR",Ce="SERVER_USER_DC",De="SERVER_SCAN_FULL",Re="SERVER_PROBE_LAUNCH",Le="PROBE_SCAN_NODE",Ae="SERVER_UPDATE_NODE_STATUS",Te="SERVER_DISCOVER_NODES",Pe="AUTO_SCAN",Be="SERVER_HACKER_ENTER_SCAN",Me="SERVER_HACKER_LEAVE_SCAN",Fe=[Re,Le,Ae,Te,Pe],Ve=new(function(){function e(){Object(o.a)(this,e),this.client=null,this.url=null,this.developmentServer=!1,this.store=null,this.waitingForType=null,this.waitingIgnoreList=[],this.subscriptions=[];var t=window.location.port,a=window.location.hostname;this.developmentServer="3000"===t,t=this.developmentServer?"80":t;var n="http:"===window.location.protocol?"ws":"wss";this.url=n+"://"+a+":"+t+"/attack_vector_websocket"}return Object(l.a)(e,[{key:"create",value:function(e,t,a){var n=this;this.store=e,this.client=Se.a.client(this.url,{debug:!1,heartbeat:{incoming:0,outgoing:0}}),a&&this.waitFor(a,null),this.client.connect({},function(e){n.onWsOpen(e,t)},function(){n.onWsConnectError()})}},{key:"onWsOpen",value:function(e,t){var a=e.headers["user-name"];this.dispatch({type:_e,data:"Logged in as [info]"+a,terminalId:"main"}),this.dispatch({type:"SET_USER_ID",userId:a}),this.setupHeartbeat(),this.subscribe("/user/reply",!1),t()}},{key:"onWsConnectError",value:function(e){this.dispatch({type:b})}},{key:"setupHeartbeat",value:function(){var e=this;this.developmentServer||setInterval(function(){e.client.send("/hb","")},15e3)}},{key:"subscribe",value:function(e,t){var a=this,n=this.client.subscribe(e,function(e){a.handleEvent(e)});t&&this.subscriptions.push(n)}},{key:"handleEvent",value:function(e){var t=JSON.parse(e.body);if(t.type!==g&&t.type!==y||this.client.disconnect(),this.waitingForType&&t.type!==y)if(t.type===this.waitingForType)this.waitingForType=null,this.waitingIgnoreList=[];else if(null===this.waitingIgnoreList||this.waitingIgnoreList.includes(t.type))return;t.type===De&&function(e){var t=e.scan,a=e.site,n=a.nodes,r=a.connections,c={};n.forEach(function(e){c[e.id]=e,e.distance=t.nodeScanById[e.id]?t.nodeScanById[e.id].distance:99999}),n.sort(function(e,t){return e.distance-t.distance}),r.sort(function(e,t){return c[e.fromId].distance-c[t.fromId].distance})}(t.data),this.store.dispatch(t)}},{key:"dispatch",value:function(e){var t=Object(U.a)({},e,{globalState:this.store.getState()});this.store.dispatch(t)}},{key:"subscribeForScan",value:function(e,t){this.subscribe("/topic/scan/"+e,!0),this.subscribe("/topic/site/"+t,!0)}},{key:"sendObject",value:function(e,t){var a=JSON.stringify(t);this.send(e,a)}},{key:"send",value:function(e,t){this.client.send(e,t)}},{key:"waitFor",value:function(e,t){this.waitingForType=e,this.waitingIgnoreList=t}},{key:"unsubscribe",value:function(){this.subscriptions.forEach(function(e){e.unsubscribe()}),this.subscriptions=[]}},{key:"abort",value:function(){this.client.disconnect()}}]),e}()),He=function(e,t){null!==e&&void 0!==e||Ue(t)},Ue=function(e){var t=(new Error).stack,a=JSON.stringify(e);console.error("Assert failed: value was null or undefined. Debug info: "+a,t),D("Internal error, please refresh browser.\n(see browser log for details)"),Ve.abort()},ze=function(e,t,a,n,r,c){var i=c||ke.fabric.util.ease.easeInOutSine;a?t.animate(a,n,{onChange:e.renderAll.bind(e),duration:50*r,easing:i}):t.animate(n,{onChange:e.renderAll.bind(e),duration:50*r,easing:i})},We=function(){function e(t,a,n,r){Object(o.a)(this,e),this.line=null,this.line=[t,a,n,r]}return Object(l.a)(e,[{key:"asArray",value:function(){return this.line}},{key:"asCoordinates",value:function(){return{x1:this.line[0],y1:this.line[1],x2:this.line[2],y2:this.line[3]}}}]),e}(),Ke=function(e,t){var a=t.x-e.x,n=t.y-e.y;return{xSpan:a,ySpan:n,distance:Math.sqrt(a*a+n*n)}},Ge=function(e,t,a){var n=e.size(),r=t.size();return qe(e,t,n,r,a)},qe=function(e,t,a,n,r){var c=Ke(e,t),i=c.xSpan,s=c.ySpan,o=c.distance,l=Ye(i,s,r),u=Object(z.a)(l,2),d=u[0],m=u[1],h=a/o,v=(o-n)/o,p=Math.floor(e.x+i*h)+d,f=Math.floor(e.y+s*h)+m,E=Math.floor(e.x+i*v)+d,y=Math.floor(e.y+s*v)+m;return new We(p,f,E,y)},Ye=function(e,t,a){if(!a)return[0,0];var n=t/(0===e?1:e),r=Math.sign(n),c=Math.abs(n);return c<.5?[0,a]:c>5?[a,0]:1===r?[-a,a]:[a,a]};function Je(e,t,a,n){return t+e/n*a}var Xe=function(){function e(t,a,n){var r=this;Object(o.a)(this,e),this.nodeData=null,this.canvas=null,this.status=null,this.nodeIcon=null,this.labelIcon=null,this.labelBackgroundIcon=null,this.y=null,this.x=null,this.updateNodeIcon=function(e){e&&r.thread.run(8,function(){ze(r.canvas,r.nodeIcon,"opacity",.05,8,ke.fabric.util.ease.easeOutSine),ze(r.canvas,r.nodeIcon,"left","-=10",8,ke.fabric.util.ease.easeOutSine)});var t=r.getNodeIconImage();r.thread.run(0,function(){r.nodeIcon.setElement(t),r.canvas.renderAll();ze(r.canvas,r.nodeIcon,"opacity",.4,8),e&&ze(r.canvas,r.nodeIcon,"left","+=10",8,ke.fabric.util.ease.easeInSine)})},this.canvas=t,this.thread=a,this.nodeData=n;var c=this.getNodeIconImage();this.x=n.x,this.y=n.y,this.nodeIcon=new ke.fabric.Image(c,{left:n.x,top:n.y,height:c.height,width:c.width,opacity:0,data:n,lockRotation:!0,lockScalingX:!0,lockScalingY:!0}),this.nodeIcon.setControlsVisibility({ml:!1,mt:!1,mr:!1,mb:!1,mtr:!1}),this.canvas.add(this.nodeIcon),this.labelIcon=new ke.fabric.Text(n.networkId,{fill:"#5cb85c",fontFamily:"courier",fontSize:12,fontStyle:"normal",left:n.x-20,top:n.y+35,textAlign:"left",opacity:0,selectable:!1}),this.canvas.add(this.labelIcon),this.nodeIcon.label=this.labelIcon,this.labelBackgroundIcon=new ke.fabric.Rect({width:20,height:20,fill:"#333333",left:n.x-20,top:n.y+35,opacity:0,selectable:!1}),this.canvas.add(this.labelBackgroundIcon),this.nodeIcon.labelBackgroundIcon=this.labelBackgroundIcon,this.canvas.sendToBack(this.labelBackgroundIcon),this.canvas.bringToFront(this.labelIcon)}return Object(l.a)(e,[{key:"getNodeIconImage",value:function(){var e=this.determineStatusForIcon(),t=function(e){var t=Object.entries(ce).find(function(t){var a=Object(z.a)(t,2),n=a[0];return a[1],n===e});return t?t[1]:null}(this.nodeData.type).name+"_"+e;return document.getElementById(t)}},{key:"determineStatusForIcon",value:function(){return"DISCOVERED"===this.nodeData.status||"TYPE"===this.nodeData.status?this.nodeData.status:"CONNECTIONS"===this.nodeData.status?"TYPE":this.nodeData.ice?"PROTECTED":"FREE"}},{key:"appear",value:function(){var e=this;this.thread.run(3,function(){ze(e.canvas,e.labelIcon,"opacity",1,40),ze(e.canvas,e.labelBackgroundIcon,"opacity",.8,40),ze(e.canvas,e.nodeIcon,"opacity",.4,40)})}},{key:"remove",value:function(){this.canvas.remove(this.nodeIcon),this.canvas.remove(this.labelIcon),this.canvas.remove(this.labelBackgroundIcon)}},{key:"updateStatus",value:function(e){this.nodeData.status=e,"CONNECTIONS"!==e&&this.updateNodeIcon(!0)}},{key:"size",value:function(){return 22}},{key:"show",value:function(){this.nodeIcon.opacity=1,this.labelIcon.opacity=1,this.labelBackgroundIcon.opacity=1,this.canvas.renderAll()}},{key:"move",value:function(e){this.nodeIcon.set({left:e.x,top:e.y}),this.nodeIcon.setCoords()}},{key:"moving",value:function(){this.x=this.nodeIcon.left,this.y=this.nodeIcon.top,this.labelIcon.left=this.nodeIcon.left-20,this.labelIcon.top=this.nodeIcon.top+35,this.labelBackgroundIcon.left=this.nodeIcon.left-20,this.labelBackgroundIcon.top=this.nodeIcon.top+35}},{key:"select",value:function(){this.canvas.setActiveObject(this.nodeIcon)}},{key:"updateNetworkId",value:function(e){this.labelIcon.setText(e),this.canvas.renderAll()}}]),e}(),Qe=function(){function e(t,a,n,r,c){Object(o.a)(this,e),this.canvas=null,this.thread=null,this.connectionIcon=null,this.connectionData=null,this.fromDisplay=null,this.toDisplay=null,this.canvas=t,this.thread=a,this.connectionData=n,this.fromDisplay=r,this.toDisplay=c;var i=Ge(r,c);this.connectionIcon=new ke.fabric.Line(i.asArray(),{stroke:"#cccccc",strokeWidth:2,strokeDashArray:[3,3],selectable:!1,hoverCursor:"default",opacity:0}),this.canvas.add(this.connectionIcon),this.canvas.sendToBack(this.connectionIcon)}return Object(l.a)(e,[{key:"appear",value:function(){var e=this;this.thread.run(3,function(){ze(e.canvas,e.connectionIcon,"opacity",.5,40)})}},{key:"show",value:function(){this.connectionIcon.opacity=1}},{key:"endPointsMoved",value:function(){var e=Ge(this.fromDisplay,this.toDisplay);this.connectionIcon.set(e.asCoordinates()),this.connectionIcon.setCoords()}}]),e}(),Ze=new(function(){function e(){Object(o.a)(this,e),this.nodeDisplayById={},this.connections=[],this.dispatch=null,this.nodeSelected=null}return Object(l.a)(e,[{key:"init",value:function(e){var t=this;this.dispatch=e,this.canvas=new ke.fabric.Canvas("canvas",{width:607,height:715,backgroundColor:"#333333"}),ke.fabric.Object.prototype.originX="center",ke.fabric.Object.prototype.originY="center",this.canvas.on("object:modified",function(e){t.canvasObjectModified(e)}),this.canvas.on("object:selected",function(e){t.canvasObjectSelected(e)}),this.canvas.on("selection:cleared",function(e){t.canvasObjectDeSelected(e)}),this.canvas.on("object:moving",function(e){t.movingNode(e.target.data.id)}),this.canvas.selection=!1}},{key:"loadSite",value:function(e){for(var t=this,a=this.canvas.getObjects();0!==a.length;)a[0].remove();this.nodeDisplayById={},this.connections=[],this.nodeSelected=null;var n=e.nodes,r=e.connections;n.forEach(function(e){t.addNode(e)}),r.forEach(function(e){t.addConnection(e)}),this.render()}},{key:"addNode",value:function(e){var t=new Xe(this.canvas,null,e);return t.show(),this.nodeDisplayById[e.id]=t,this.canvas.deactivateAll(),this.render(),t}},{key:"selectNode",value:function(e){var t=this.nodeDisplayById[e];t.select(),this.nodeSelected=t.nodeIcon,this.dispatch({type:"SELECT_NODE",data:e})}},{key:"addConnection",value:function(e){var t=this.nodeDisplayById[e.fromId],a=this.nodeDisplayById[e.toId],n=new Qe(this.canvas,null,e,t,a);n.show(),this.connections.push(n),this.render()}},{key:"render",value:function(){this.canvas.renderAll()}},{key:"canvasObjectModified",value:function(e){this.dispatch({type:de,id:e.target.data.id,x:e.target.left,y:e.target.top})}},{key:"moveNode",value:function(e){var t=e.nodeId,a=this.nodeDisplayById[t];He(a,e),a.move(e),this.movingNode(t)}},{key:"movingNode",value:function(e){this.nodeDisplayById[e].moving(),this.connections.forEach(function(t){t.connectionData.fromId!==e&&t.connectionData.toId!==e||t.endPointsMoved()}),this.render()}},{key:"getNodeSelectedId",value:function(){var e=this.canvas.getActiveObject();return e&&e.data&&"image"===e.get("type")?e.data.id:null}},{key:"canvasObjectSelected",value:function(e){var t=e.target;t.data&&t.data.id?(this.nodeSelected&&e.e&&e.e.ctrlKey?(this.dispatch({type:he,fromId:this.nodeSelected.data.id,toId:t.data.id}),this.nodeSelected=t):this.nodeSelected=t,this.dispatch({type:"SELECT_NODE",data:t.data.id})):console.log("somehow selected a non-node: "+t)}},{key:"canvasObjectDeSelected",value:function(e){this.nodeSelected=null,this.dispatch({type:"SELECT_NODE",data:null})}},{key:"updateNetworkId",value:function(e){var t=e.nodeId,a=e.value;this.nodeDisplayById[t].updateNetworkId(a)}},{key:"openService",value:function(e,t){this.selectNode(e)}}]),e}()),$e=Object(h.b)(function(e){return{}},function(e){return{}})(function(e){e.dispatch;var t=function(){Ze.render()};return r.a.createElement("div",{className:"col-lg-2",id:"node-library"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 darkWell node_panel_no_right_padding",id:"node-library"},r.a.createElement("br",null),r.a.createElement("p",{className:"text-muted"},"Content nodes"),r.a.createElement(Oe,{type:Y,ice:!1,title:"Syscon",onLoad:t}),r.a.createElement(Oe,{type:J,ice:!1,title:"Data (info) store",onLoad:t}),r.a.createElement(Oe,{type:X,ice:!1,title:"Passcode store",onLoad:t}),r.a.createElement(Oe,{type:Q,ice:!1,title:"Resource store",onLoad:t}),r.a.createElement(Oe,{type:W,ice:!1,title:"Transit",onLoad:t}),r.a.createElement(Oe,{type:K,ice:!1,title:"Transit",onLoad:t}),r.a.createElement(Oe,{type:G,ice:!1,title:"Transit",onLoad:t}),r.a.createElement(Oe,{type:q,ice:!1,title:"Transit",onLoad:t}),r.a.createElement("p",{className:"text-muted"},"Automated mini game ice nodes"),r.a.createElement(Oe,{type:Z,ice:!0,title:"Ice: word search",onLoad:t}),r.a.createElement(Oe,{type:$,ice:!0,title:"Ice: magic eye",onLoad:t}),r.a.createElement(Oe,{type:ee,ice:!0,title:"Ice: password guess",onLoad:t}),r.a.createElement(Oe,{type:te,ice:!0,title:"Ice: unhackable",onLoad:t}),r.a.createElement("p",{className:"text-muted"},"Manual mini game ice nodes"),r.a.createElement(Oe,{type:ae,ice:!0,title:"Ice: manual / gm puzzle",onLoad:t}),r.a.createElement(Oe,{type:ne,ice:!0,title:"Ice: manual / gm puzzle",onLoad:t}),r.a.createElement(Oe,{type:re,ice:!0,title:"Ice: manual / gm puzzle",onLoad:t}),r.a.createElement("br",null),r.a.createElement("br",null))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("span",{className:"text-muted"}," Nodes, drag to editor"))))}),et=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){Ze.init(this.props.dispatch)}},{key:"allowDrop",value:function(e){e.preventDefault()}},{key:"drop_image_and_create_node",value:function(e){var t=e.nativeEvent,a=t.offsetX,n=t.offsetY;this.props.dispatch({type:le,x:a,y:n,dragAndDropState:this.props.dragAndDropState}),t.preventDefault()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"col-lg-5",id:"canvas-col"},r.a.createElement("div",{id:"canvas-container",onDragOver:function(t){return e.allowDrop(t)},onDrop:function(t){return e.drop_image_and_create_node(t)}},r.a.createElement("canvas",{id:"canvas",width:"607",height:"715",style:{borderRadius:"3px 3px 3px 3px"}})))}}]),t}(n.Component),tt=Object(h.b)(function(e){return{state:e}},function(e){return{dispatch:e}})(function(e){var t=e.dispatch;return r.a.createElement("span",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 darkWell"},r.a.createElement("br",null),r.a.createElement("div",null,r.a.createElement("div",{className:"btn btn-info btn-spaced",onClick:function(){return function(){var e=Ze.getNodeSelectedId();e&&t({type:pe,nodeId:e})}()}},"Delete Lines"),r.a.createElement("div",{className:"btn btn-info btn-spaced",onClick:function(){return function(){var e=Ze.getNodeSelectedId();e&&t({type:fe,nodeId:e})}()}},"Delete Node"),r.a.createElement("div",{className:"btn btn-info btn-spaced",onClick:function(){t({type:Ee})}},"Snap"),r.a.createElement("div",{className:"btn btn-info disabled btn_tooltip btn-spaced","data-placement":"bottom",title:"Control-click new node to connect with current selected node."},"Connect")),r.a.createElement("br",null))))}),at=13,nt=function(e){function t(e,a,n){var r;return Object(o.a)(this,t),(r=Object(u.a)(this,Object(d.a)(t).call(this,e,a,n))).componentWillReceiveProps=function(e){r.setState({value:e.value,saving:!1,initialized:!0})},r.componentWillUnmount=function(){r.handleBlur()},r.handleChange=function(e){var t=e.target.value;r.setState({value:t,initialized:!0,saving:!1})},r.handleKeyDown=function(e){e.keyCode===at&&e.target.blur()},r.handleBlur=function(e){r.state.initialized&&r.state.value!==r.props.value&&(r.props.save(r.state.value),r.setState(Object(U.a)({},r.state,{saving:!0})))},r.state={value:e.value,saving:!1,initialized:!0},r}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.className,n=t.placeholder,c=this.state.value;null!==c&&void 0!==c||(c="");var i=this.state.saving?r.a.createElement("span",{className:"glyphicon glyphicon-floppy-save form-control-feedback","aria-hidden":"true"}):"";return"textArea"===this.props.type?r.a.createElement("span",null,r.a.createElement("textarea",{className:a,placeholder:n,value:c,onChange:function(t){return e.handleChange(t)},onKeyDown:function(t){return e.handleKeyDown(t)},onBlur:function(t){return e.handleBlur(t)},rows:this.props.rows}),i):r.a.createElement("span",null,r.a.createElement("input",{type:"text",className:a,placeholder:n,value:c,onChange:function(t){return e.handleChange(t)},onKeyDown:function(t){return e.handleKeyDown(t)},onBlur:function(t){return e.handleBlur(t)}}),i)}}]),t}(n.Component),rt=Object(h.b)(function(e){return{}},function(e){return{fieldChange:function(e){return alert("data="+e)}}})(function(e){var t=e.name,a=e.size,n=e.readOnly,c=e.value,i=e.save,s=e.placeholder,o=e.help;n||(n=!1);var l="large"===a?"col-lg-8 noRightPadding":"col-lg-4 noRightPadding";return r.a.createElement("div",{className:"row form-group serviceFieldRow"},r.a.createElement("div",{className:"col-lg-3 serviceLabel"},t),r.a.createElement("div",{className:l},function(e,t,a,n){return t?r.a.createElement("span",null,r.a.createElement("input",{type:"text",className:"form-control input-sm serviceInputLong",disabled:t,value:e})):r.a.createElement(nt,{className:"form-control input-sm",placeholder:n,value:e,save:function(e){return a(e)}})}(c,n,i,s)),r.a.createElement("div",{className:"col-lg-1 serviceHelpColumn"},r.a.createElement("span",{className:"badge helpBadge",title:o},"?")))}),ct=a(27),it=function(){function e(t,a,n){Object(o.a)(this,e),this.service=t,this.node=a,this.dispatch=n}return Object(l.a)(e,[{key:"_save",value:function(e,t){this.dispatch({type:be,nodeId:this.node.id,serviceId:this.service.id,key:e,value:t})}},{key:"saveNote",value:function(e){this._save("note",e)}},{key:"saveName",value:function(e){this._save("name",e)}},{key:"id",get:function(){return this.service.id}},{key:"name",get:function(){return this.service.data.name}},{key:"note",get:function(){return this.service.data.note}}]),e}(),st=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"saveNetworkId",value:function(e){this.dispatch({type:ye,nodeId:this.node.id,value:e})}},{key:"saveNodeName",value:function(e){Object(ct.a)(Object(d.a)(t.prototype),"_save",this).call(this,"nodeName",e)}},{key:"networkId",get:function(){return this.node.networkId}},{key:"nodeName",get:function(){return this.service.data.nodeName}}]),t}(it),ot=a(16),lt=function(e,t,a){var n=ut(t,a),r=t[n],c=Object(U.a)({},r,e),i=Object(ot.a)(t);return i.splice(n,1,c),i},ut=function(e,t){var a=null;return e.forEach(function(e,n){e.id===t&&(a=n)}),He(a,{array:e,id:t}),a},dt=function(e,t){return e[ut(e,t)]},mt=function(e){var t=e.type,a=e.name;return a?"glyphicon "+a:"glyphicon "+function(e){switch(e){case"OS":return"glyphicon-home";case"TEXT":return"glyphicon-file";case"PICTURE":return"glyphicon-picture";case"LINK":return"glyphicon-link";case"TRACER":return"glyphicon-transfer";case"TRACE_LOG":return"glyphicon-erase";case"SCAN_BLOCK":return"glyphicon-magnet";case"MONEY":return"glyphicon-usd";case"CODE":return"glyphicon-ok-circle";case"TIME":return"glyphicon-time";case"CORE":return"glyphicon-th-large";case"ICE_PASSWORD":return"glyphicon-console";case"ICE_FILM":return"glyphicon-film";case"ICE_NETWALK":return"glyphicon-qrcode";case"ICE_WORD_SEARCH":return"glyphicon-th";case"ICE_MAGIC_EYE":return"glyphicon-eye-close";case"ICE_PASSWORD_SEARCH":return"glyphicon-tasks";case"ICE_ALTERNATE":return"glyphicon-star";case"ICE_UNHACKABLE":return"glyphicon-ban-circle";default:return console.log("unknown type:"+e),"glyphicon-thumbs-down"}}(t)},ht=function(e){var t=mt(e),a=e.size?e.size:"14px",n=e.display?e.display:"inherit";return r.a.createElement("span",{className:t,style:{fontSize:a,display:n,zIndex:"100",color:e.color}})},vt=Object(h.b)(function(e){return{}},function(e){return{remove:function(t,a){return e({type:Ne,nodeId:t,serviceId:a})}}})(function(e){var t=e.type,a=e.node,n=e.service,c=e.remove;return r.a.createElement("div",{className:"row form-group serviceFieldTopRow"},r.a.createElement("div",{className:"col-lg-3 control-label serviceLabel"},"Service"),r.a.createElement("div",{className:"col-lg-8"},r.a.createElement("div",{className:"text-muted strong service_text_label text_gold"},t,function(e,t,a){return"OS"===t.type?null:r.a.createElement("span",{className:"pull-right",style:{display:"block"}},r.a.createElement(N,{onClick:function(){return a(e.id,t.id)}},r.a.createElement(ht,{name:"glyphicon-remove",size:"18px",display:"block"})))}(a,n,c))))}),pt=Object(h.b)(function(e){return{}},function(e){var t=function(t,a,n){e({type:Ie,nodeId:t.id,fromId:a.id,toId:t.services[n].id})};return{up:function(e,a){return t(e,a,a.layer-1)},down:function(e,a){return t(e,a,a.layer+1)}}})(function(e){var t=e.node,a=e.service,n=e.up,c=e.down,i=a.layer,s=i>1?r.a.createElement(N,{className:"textLink",onClick:function(){return n(t,a)}},"\u25c0"):r.a.createElement("span",null,"\u25c0"),o=0!==i&&i<t.services.length-1?r.a.createElement(N,{className:"textLink",onClick:function(){return c(t,a)}},"\u25b6"):r.a.createElement("span",null,"\u25b6");return r.a.createElement("div",{className:"row form-group serviceFieldRow"},r.a.createElement("div",{className:"col-lg-3 serviceLabel"},"Layer"),r.a.createElement("div",{className:"col-lg-8"},r.a.createElement("div",{className:"text-muted strong service_text_label"},i,"\xa0",s,"\xa0",o)))}),ft=Object(h.b)(function(e){if(!e.currentNodeId)return{};var t=dt(e.nodes,e.currentNodeId);return{node:t,serviceData:dt(t.services,e.currentServiceId)}},function(e){return{dispatch:e}})(function(e){var t=e.type,a=e.node,n=e.serviceData,c=e.serviceObject,i=e.children;if(!a)return r.a.createElement("div",null);var s=function(e){return n.id+":"+e};return r.a.createElement("div",{className:"tab-content",id:"node-services-tab-content "},r.a.createElement("div",{className:"tab-pane active"},r.a.createElement(vt,{type:t,node:a,service:n}),r.a.createElement(pt,{service:n,node:a}),r.a.createElement(rt,{key:s("id"),size:"small",name:"Service id",value:c.id,readOnly:!0,help:"Unique ID of this service. Used when services refer to each other."}),r.a.createElement(rt,{key:s("nn"),size:"small",name:"Service name",value:c.name,save:function(e){return c.saveName(e)},placeholder:"As seen by hackers",help:"When a hacker 'scans' or 'views' a node they will see the services by this name."}),i,r.a.createElement(rt,{key:s("no"),size:"large",name:"Gm Note",value:c.note,save:function(e){return c.saveNote(e)},placeholder:"",help:"Players will never see this. Notes can help to understand the design of a site."})))}),Et=Object(h.b)(function(e){return{}},function(e){return{dispatch:e}})(function(e){var t=e.node,a=e.service,n=e.dispatch,c=new st(a,t,n),i=function(e){return a.id+":"+e};return r.a.createElement(ft,{type:"OS",serviceObject:c},r.a.createElement(rt,{key:i("nw"),size:"small",name:"Network \u25a3",value:c.networkId,save:function(e){return c.saveNetworkId(e)},help:"This is the number shown next to the node icon.\r It is used by the hacker to navigate through the site.",placeholder:"<xx>"}),r.a.createElement(rt,{key:i("nn"),size:"large",name:"Node name",value:c.nodeName,save:function(e){return c.saveNodeName(e)},placeholder:"Optional name",help:"When a node has a name, this is shown in the scan and when a hacker enters the node.\r It can be used to give a node extra meaning."}))}),yt=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"saveText",value:function(e){Object(ct.a)(Object(d.a)(t.prototype),"_save",this).call(this,"text",e)}},{key:"text",get:function(){return this.service.data.text}}]),t}(it),bt=Object(h.b)(function(e){return{}},function(e){return{dispatch:e}})(function(e){var t,a=e.node,n=e.service,c=e.dispatch,i=new yt(n,a,c);return r.a.createElement(ft,{type:"Text",serviceObject:i},r.a.createElement(rt,{key:(t="ha",n.id+":"+t),size:"large",name:"Hacked text",value:i.text,save:function(e){return i.saveText(e)},placeholder:"* Data found: ...",help:"This is the text displayed when a player hacks this service.\r It can be used to provide data, or to simulate that some effect has taken place."}))}),gt=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"savePassword",value:function(e){Object(ct.a)(Object(d.a)(t.prototype),"_save",this).call(this,"password",e)}},{key:"saveHint",value:function(e){Object(ct.a)(Object(d.a)(t.prototype),"_save",this).call(this,"hint",e)}},{key:"password",get:function(){return this.service.data.password}},{key:"hint",get:function(){return this.service.data.hint}}]),t}(it),Nt=Object(h.b)(function(e){return{}},function(e){return{dispatch:e}})(function(e){var t=e.node,a=e.service,n=e.dispatch,c=new gt(a,t,n),i=function(e){return a.id+":"+e};return r.a.createElement(ft,{type:"ICE Password",serviceObject:c},r.a.createElement(rt,{key:i("pa"),size:"large",name:"Password",value:c.password,save:function(e){return c.savePassword(e)},placeholder:"* Password / passphrase",help:"The password or passphrase the hacker needs to enter to bypass this ice."}),r.a.createElement(rt,{key:i("hi"),size:"large",name:"Hint",value:c.hint,save:function(e){return c.saveHint(e)},placeholder:"Optional hint",help:"This hint is shown when the password is entered incorrectly.\r Can be used to help hackers."}))}),It=Object(h.b)(function(e){if(null==e.currentNodeId)return{services:[],currentService:null};var t=dt(e.nodes,e.currentNodeId),a=dt(t.services,e.currentServiceId);return{node:t,services:t.services,currentService:a}},function(e){return{selectService:function(t){return e({type:"SELECT_SERVICE",serviceId:t.id})}}})(function(e){var t=e.node,a=e.services,n=e.currentService,c=e.selectService;return n?r.a.createElement("div",{className:"row form-horizontal darkWell serviceLayerPanel"},r.a.createElement("div",{className:"row"},"\xa0"),r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("ul",{className:"nav nav-tabs",role:"tablist",id:"node-services-tab-list"},a.map(function(e){return function(e,t,a){var n=e===t?"active":"";return r.a.createElement("li",{role:"presentation",className:n,key:e.id},r.a.createElement(N,{onClick:function(){return a(e)},"aria-controls":"home",role:"tab","data-toggle":"tab"},r.a.createElement(ht,{type:e.type,size:"18px"})))}(e,n,c)})),r.a.createElement("br",null),function(e,t){switch(t.type){case null:return null;case"OS":return r.a.createElement(Et,{node:e,service:t});case"TEXT":return r.a.createElement(bt,{node:e,service:t});case"ICE_PASSWORD":return r.a.createElement(Nt,{node:e,service:t});default:return r.a.createElement("div",{className:"text"},"NodeDetailPanel: ERROR: service type unknown: ",t.type," for ",t.id)}}(t,n))):r.a.createElement("div",{className:"row form-horizontal darkWell serviceLayerPanel"})}),Ot=Object(h.b)(function(e){return{state:e,currentNodeId:e.currentNodeId}},function(e){return{add:function(t,a,n){n&&null!=a&&e({type:ge,serviceType:t,nodeId:a})}}})(function(e){var t,a=e.add,n=e.currentNodeId,c=function(e){return r.a.createElement("span",{className:"btn btn-grey btn-spaced"},r.a.createElement(ht,{type:e,size:"18px"}))};return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 darkWell"},r.a.createElement("br",null),r.a.createElement("div",null,(t="TEXT",r.a.createElement("span",{className:"btn btn-info btn-spaced",onClick:function(){a(t,n,!0)}},r.a.createElement(ht,{type:t,size:"18px"}))),c("PICTURE"),c("LINK"),c("TRACER"),c("TRACE_LOG"),c("SCAN_BLOCK"),c("MONEY"),c("CODE"),c("TIME"),c("CORE")),r.a.createElement("div",{className:"btn-height-spacer"}),r.a.createElement("div",null,function(e){return r.a.createElement("span",{className:"btn btn-info btn-spaced btn-narrowed",onClick:function(){a(e,n,!0)}},r.a.createElement(ht,{type:e,size:"18px",color:"NavajoWhite"}))}("ICE_PASSWORD"),c("ICE_FILM"),c("ICE_NETWALK"),c("ICE_WORD_SEARCH"),c("ICE_MAGIC_EYE"),c("ICE_PASSWORD_SEARCH"),c("ICE_ALTERNATE"),c("ICE_UNHACKABLE")),r.a.createElement("br",null)))}),kt=Object(h.b)(function(e){return{}},function(e){return{}})(function(){return r.a.createElement("span",null,r.a.createElement("div",{className:"col-lg-5",id:"node-library"},r.a.createElement(tt,null),r.a.createElement("div",{className:"row"},"\xa0"),r.a.createElement(Ot,null),r.a.createElement("div",{className:"row"},"\xa0"),r.a.createElement(It,null)))}),wt=Object(h.b)(function(e){return{dragAndDropState:e.dragAndDrop}},function(e){return{dispatch:e}})(function(e){var t=e.dragAndDropState,a=e.dispatch;return r.a.createElement("span",null,r.a.createElement("div",{className:"row"},r.a.createElement($e,null),r.a.createElement(et,{dragAndDropState:t,dispatch:a}),r.a.createElement(kt,null)))}),St=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={initialized:!1},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({value:e.target.checked,initialized:!0}),this.props.save(e.target.checked)}},{key:"render",value:function(){var e,t=this,a=this.props.className;return e=this.state.initialized?this.state.value:!!this.props.value&&this.props.value,r.a.createElement("input",{type:"checkbox",className:a,checked:e,onChange:function(e){return t.handleChange(e)}})}}]),t}(n.Component),xt=Object(h.b)(function(e){return{siteData:e.siteData}},function(e){return{save:function(t,a){e({type:oe,field:t,value:a})}}})(function(e){var t=e.siteData,a=e.save;return r.a.createElement("span",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-7"},r.a.createElement("div",{className:"row form-horizontal"},r.a.createElement("div",{className:"form-group has-feedback"},r.a.createElement("label",{htmlFor:"site_name",className:"col-lg-4 control-label text-muted"},"Name"),r.a.createElement("div",{className:"col-lg-8"},r.a.createElement(nt,{id:"site_name",className:"form-control",placeholder:"Display name",value:t.name,save:function(e){return a("name",e)}}))),r.a.createElement("div",{className:"form-group has-feedback"},r.a.createElement("label",{htmlFor:"start_node",className:"col-lg-4 control-label text-muted"},"Start node"),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement(nt,{id:"start_node",className:"form-control",placeholder:"Network Id",value:t.startNodeNetworkId,save:function(e){return a("startNode",e)}}))))),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("div",{className:"row form-horizontal"},r.a.createElement("div",{className:"form-group has-feedback"},r.a.createElement("label",{htmlFor:"hack_time",className:"col-lg-5 control-label text-muted"},"Hack time"),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement(nt,{id:"hack_time",className:"form-control",placeholder:"(mm:ss)",value:t.hackTime,save:function(e){return a("hackTime",e)}}))),r.a.createElement("div",{className:"form-group has-feedback"},r.a.createElement("label",{htmlFor:"site_hackable",className:"col-lg-5 control-label text-muted"},"Hackable"),r.a.createElement("div",{className:"col-lg-2"},r.a.createElement(St,{id:"site_hackable",className:"form-control",checked:t.hackable,save:function(e){return a("hackable",e)}})))))))}),_t=function(e,t){var a="INFO"===e.type?r.a.createElement("span",{className:"label label-info"},"Info\xa0"):r.a.createElement("span",{className:"label label-warning"},"Error"),n=e.serviceId?r.a.createElement(r.a.Fragment,null,"\xa0",r.a.createElement(N,{onClick:function(){var t,a;t=e.nodeId,a=e.serviceId,Ze.openService(t,a)}},r.a.createElement("span",{className:"glyphicon glyphicon-share-alt"}))):r.a.createElement(r.a.Fragment,null);return r.a.createElement("div",{className:"row",key:t},r.a.createElement("div",{className:"col-lg-12 site-state-text"},a,n,"\xa0",e.text))},jt=Object(h.b)(function(e){return{siteState:e.state}},function(e){return{}})(function(e){var t=e.siteState,a=t.ok?r.a.createElement("span",{className:"label label-success"},"Ok"):r.a.createElement("span",{className:"label label-warning"},"Error");return r.a.createElement("div",{className:"site-state"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 site-state-text"},"Status:\xa0",a)),r.a.createElement("hr",{className:"thin-hr"}),t.messages.map(function(e,t){return _t(e,t)}))}),Ct=Object(h.b)(function(e){return{}},function(e){return{}})(function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 darkWell"},r.a.createElement("br",null),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(xt,null)),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement(jt,null)))))}),Dt=Object(h.b)(function(e){return{siteData:e.siteData}},function(e){return{save:function(t,a){e({type:oe,field:t,value:a})}}})(function(e){var t=e.siteData,a=e.save;return r.a.createElement("span",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("div",{className:"row form-horizontal"},r.a.createElement("div",{className:"form-group has-feedback"},r.a.createElement("label",{htmlFor:"site_description",className:"col-lg-3 control-label text-muted"},"Description"),r.a.createElement("div",{className:"col-lg-8"},r.a.createElement(nt,{type:"textArea",id:"site_description",rows:"2",className:"form-control",placeholder:"For GM only",value:t.description,save:function(e){return a("description",e)}}))))),r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("div",{className:"row form-horizontal"},r.a.createElement("div",{className:"form-group has-feedback"},r.a.createElement("label",{htmlFor:"gm_name",className:"col-lg-3 control-label text-muted"},"Creator"),r.a.createElement("div",{className:"col-lg-8"},r.a.createElement(nt,{id:"gm_name",className:"form-control",placeholder:"",value:t.creator,save:function(e){return a("creator",e)}})))))))}),Rt=Object(h.b)(function(e){return{}},function(e){return{}})(function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 darkWell"},r.a.createElement("br",null),r.a.createElement(Dt,null)))}),Lt=Object(h.b)(function(e){return{}},function(e){return{}})(function(){return r.a.createElement("div",{className:"container"},r.a.createElement("br",null),r.a.createElement(Ct,null),r.a.createElement("br",null),r.a.createElement(wt,null),r.a.createElement("br",null),r.a.createElement(Rt,null))}),At=a(2),Tt=a.n(At),Pt=a(3),Bt=Tt.a.mark(qt),Mt=Tt.a.mark(Yt),Ft=Tt.a.mark(Jt),Vt=Tt.a.mark(Xt),Ht=Tt.a.mark(Qt),Ut=Tt.a.mark(Zt),zt=Tt.a.mark($t),Wt=Tt.a.mark(ea),Kt=Tt.a.mark(ta),Gt=function(e){return e.siteData.id};function qt(e){var t,a,n,r,c,i;return Tt.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(Pt.c)(Gt);case 2:return t=s.sent,a=e.x-e.dragAndDropState.dx,n=e.y-e.dragAndDropState.dy,r=e.dragAndDropState.type.name.toUpperCase(),c={siteId:t,x:a,y:n,type:r},i=JSON.stringify(c),Ve.send("/av/editor/addNode",i),void(s.next=11);case 11:case"end":return s.stop()}},Bt)}function Yt(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Ze.addNode(e.data),Ze.selectNode(e.data.id),void(t.next=4);case 4:case"end":return t.stop()}},Mt)}function Jt(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(Gt);case 2:return t=r.sent,a={siteId:t,nodeId:e.id,x:e.x,y:e.y},n=JSON.stringify(a),Ve.send("/av/editor/moveNode",n),void(r.next=8);case 8:case"end":return r.stop()}},Ft)}function Xt(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ze.moveNode(e.data);case 2:case"end":return t.stop()}},Vt)}function Qt(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(Gt);case 2:return t=r.sent,a={siteId:t,fromId:e.fromId,toId:e.toId},n=JSON.stringify(a),Ve.send("/av/editor/addConnection",n),void(r.next=8);case 8:case"end":return r.stop()}},Ht)}function Zt(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ze.addConnection(e.data);case 2:case"end":return t.stop()}},Ut)}function $t(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(Gt);case 2:return t=r.sent,a={siteId:t,nodeId:e.nodeId},n=JSON.stringify(a),Ve.send("/av/editor/deleteConnections",n),void(r.next=8);case 8:case"end":return r.stop()}},zt)}function ea(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(Gt);case 2:return t=r.sent,a={siteId:t,nodeId:e.nodeId},n=JSON.stringify(a),Ve.send("/av/editor/deleteNode",n),void(r.next=8);case 8:case"end":return r.stop()}},Wt)}function ta(e){var t,a,n;return Tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Pt.c)(Gt);case 2:return t=e.sent,a={siteId:t},n=JSON.stringify(a),Ve.send("/av/editor/snap",n),void(e.next=8);case 8:case"end":return e.stop()}},Kt)}var aa=Tt.a.mark(ia),na=Tt.a.mark(sa),ra=Tt.a.mark(oa),ca=function(e){return e.siteData.id};function ia(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Ve.send("/av/editor/siteFull",e.siteId),void(t.next=3);case 3:case"end":return t.stop()}},aa)}function sa(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ze.loadSite(e.data);case 2:case"end":return t.stop()}},na)}function oa(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(ca);case 2:return t=r.sent,a={siteId:t,field:e.field,value:e.value},n=JSON.stringify(a),Ve.send("/av/editor/editSiteData",n),void(r.next=8);case 8:case"end":return r.stop()}},ra)}var la=Tt.a.mark(ha),ua=Tt.a.mark(va),da=Tt.a.mark(pa),ma=Tt.a.mark(fa);function ha(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return R(e.data),void(t.next=3);case 3:case"end":return t.stop()}},la)}function va(e){return Tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return D("Connection with server lost. Please refresh browser."),this.dispatch({type:_e,data:"[b warn]Connection with server lost. Please refresh browser."}),void(e.next=4);case 4:case"end":return e.stop()}},ua,this)}function pa(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return R(e.data),void(t.next=3);case 3:case"end":return t.stop()}},da)}function fa(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return D(e.data.message),void(t.next=3);case 3:case"end":return t.stop()}},ma)}var Ea=Tt.a.mark(ka),ya=Tt.a.mark(wa),ba=Tt.a.mark(Sa),ga=Tt.a.mark(xa),Na=Tt.a.mark(_a),Ia=Tt.a.mark(ja),Oa=function(e){return e.siteData.id};function ka(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ja(e,"/av/editor/editNetworkId");case 2:return Ze.updateNetworkId(e),void(t.next=5);case 5:case"end":return t.stop()}},Ea)}function wa(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ja(e,"/av/editor/editServiceData");case 2:return void(t.next=4);case 4:case"end":return t.stop()}},ya)}function Sa(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ja(e,"/av/editor/addService");case 2:return void(t.next=4);case 4:case"end":return t.stop()}},ba)}function xa(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ja(e,"/av/editor/removeService");case 2:return void(t.next=4);case 4:case"end":return t.stop()}},ga)}function _a(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ja(e,"/av/editor/swapServiceLayer");case 2:return void(t.next=4);case 4:case"end":return t.stop()}},Na)}function ja(e,t){var a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(Oa);case 2:return a=r.sent,n=Object(U.a)({},e,{type:void 0,siteId:a}),Ve.sendObject(t,n),void(r.next=7);case 7:case"end":return r.stop()}},Ia)}var Ca=function(){var e=Tt.a.mark(a),t=Tt.a.mark(n);function a(){return Tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Pt.d)(E,ha);case 2:return e.next=4,Object(Pt.d)(b,va);case 4:return e.next=6,Object(Pt.d)(g,pa);case 6:return e.next=8,Object(Pt.d)(y,fa);case 8:return e.next=10,Object(Pt.d)(ie,ia);case 10:return e.next=12,Object(Pt.d)(se,sa);case 12:return e.next=14,Object(Pt.d)(le,qt);case 14:return e.next=16,Object(Pt.d)(ue,Yt);case 16:return e.next=18,Object(Pt.d)(de,Jt);case 18:return e.next=20,Object(Pt.d)(me,Xt);case 20:return e.next=22,Object(Pt.d)(he,Qt);case 22:return e.next=24,Object(Pt.d)(ve,Zt);case 24:return e.next=26,Object(Pt.d)(oe,oa);case 26:return e.next=28,Object(Pt.d)(pe,$t);case 28:return e.next=30,Object(Pt.d)(fe,ea);case 30:return e.next=32,Object(Pt.d)(Ee,ta);case 32:return e.next=34,Object(Pt.d)(be,wa);case 34:return e.next=36,Object(Pt.d)(ye,ka);case 36:return e.next=38,Object(Pt.d)(ge,Sa);case 38:return e.next=40,Object(Pt.d)(Ne,xa);case 40:return e.next=42,Object(Pt.d)(Ie,_a);case 42:case"end":return e.stop()}},e)}function n(){return Tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Pt.a)([a()]);case 2:case"end":return e.stop()}},t)}return n},Da=a(43),Ra=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"frontier";return(arguments.length>1?arguments[1]:void 0).type,e},La=function(e,t){var a=Object(U.a)({},e);return[].concat(Object(ot.a)(t),[a])},Aa={id:"unknown",nodeIds:[],connectionIds:[]},Ta=function(e,t){var a=[].concat(Object(ot.a)(t.nodeIds),[e.id]);return Object(U.a)({},t,{nodeIds:a})},Pa={id:null,name:"non name yet",description:"",creator:null,hackTime:"-",startNodeNetworkId:"00",hackable:!1},Ba=function(e,t){var a=Object(U.a)({},e,{connections:[]});return[].concat(Object(ot.a)(t),[a])},Ma=function(e,t){var a={x:e.x,y:e.y};return lt(a,t,e.nodeId)},Fa=function(e,t){var a=dt(t,e.nodeId),n=dt(a.services,e.serviceId),r=Va(e,n),c=lt(r,a.services,e.serviceId);return lt({services:c},t,e.nodeId)},Va=function(e,t){if(e.serviceId!==t.id)return t;var a=Object(U.a)({},t.data);return a[e.key]=e.value,Object(U.a)({},t,{data:a})},Ha=function(e,t){var a={networkId:e.networkId};return lt(a,t,e.nodeId)},Ua=function(e,t){var a=dt(t,e.nodeId),n=e.service,r=[].concat(Object(ot.a)(a.services),[n]);return lt({services:r},t,e.nodeId)},za=function(e,t){return lt(e,t,e.id)},Wa=function(e,t){if(null===e)return null;var a=dt(t,e),n=a.services.length-1;return a.services[n].id},Ka=function(e,t){return e||t},Ga={ok:!0,messages:[]},qa=function(e,t){var a={};return a.siteData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{siteDataDefaultState:Pa},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return t.data.siteData;case De:return t.data.site.siteData;case"SERVER_UPDATE_SITE_DATA":return t.data;default:return e}}(e.siteData,t),a.layout=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Aa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return t.data.layout;case ue:return Ta(t.data,e);default:return e}}(e.layout,t),a.dragAndDrop=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"RESOURCE",dx:0,dy:0,ice:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"DRAG_START":return t.data;default:return e}}(e.dragAndDrop,t),a.theme=Ra(e.theme,t),a.nodes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return t.data.nodes;case ue:return Ba(t.data,e);case me:return Ma(t.data,e);case"SERVER_UPDATE_NETWORK_ID":return Ha(t.data,e);case"SERVER_UPDATE_SERVICE_DATA":return Fa(t.data,e);case"SERVER_ADD_SERVICE":return Ua(t.data,e);case"SERVER_NODE_UPDATED":return za(t.data.node,e);default:return e}}(e.nodes,t),a.connections=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return t.data.connections;case ve:return La(t.data,e);default:return e}}(e.connections,t),a.currentNodeId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_NODE":return t.data;default:return e}}(e.currentNodeId,t,e.nodes),a.currentServiceId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,a=(arguments.length>2&&arguments[2],arguments.length>3?arguments[3]:void 0);switch(t.type){case"SELECT_NODE":return Wa(t.data,a);case"SERVER_ADD_SERVICE":return t.data.service.id;case"SELECT_SERVICE":return t.serviceId;case"SERVER_NODE_UPDATED":return Ka(t.data.serviceId,e);default:return e}}(e.currentServiceId,t,e.currentNodeId,e.nodes),a.state=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ga,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return t.data.state;case"SERVER_UPDATE_SITE_STATE":return t.data;default:return e}}(e.state,t),a},Ya=function(e){function t(e){var a;if(Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={initSuccess:null},a.errorMessage=null,a.siteId=e.match.params.siteId,!a.siteId.startsWith("site-"))return a.errorMessage="Cannot enter site name directly in URL",a.state={initSuccess:!1},Object(u.a)(a);document.body.style.backgroundColor="#f5f5f5";var n={siteData:Object(U.a)({},Pa,{id:a.siteId})},r=Object(Da.a)(),c=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||P.d;a.store=Object(P.e)(qa,n,c(Object(P.a)(r))),Ve.create(a.store,function(){Ve.subscribe("/topic/site/"+a.siteId),a.state={initSuccess:!0},a.store.dispatch({type:ie,siteId:a.siteId})},se);var i=Ca();return r.run(i),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"renderIfAuthenticated",value:function(){return!1===this.state.initSuccess?r.a.createElement("h1",{className:"text"},this.errorMessage," ",r.a.createElement("a",{href:"/"},"Continue.")):r.a.createElement(h.a,{store:this.store},r.a.createElement(Lt,null))}},{key:"render",value:function(){return r.a.createElement(T,{requires:"ROLE_SITE_MANAGER"},this.renderIfAuthenticated())}}]),t}(n.Component),Ja=a(40),Xa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).renderName=function(e){var t=Object(Ja.a)(a);return r.a.createElement("div",{className:"row",key:e},r.a.createElement("div",{className:"col-lg-offset-2 col-lg-5"},r.a.createElement("div",{className:"text"},r.a.createElement("a",{href:"#",onClick:function(a){return t.login(e,""),a.preventDefault(),!1}},e))))},a.loginFunction=e.loginFunction,a.state={name:"",password:"",message:a.props.message},a.names=["Obsidian","Paradox","Shade_zero","_eternity_","BoltBishop","CryptoLaw","Moonshine","Angler","N1X","Face.dread","-=Silver=-","C_H_I_E_F",".Specter.","Stalker"],a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onNameChange",value:function(e){this.setState({name:e})}},{key:"onPasswordChange",value:function(e){this.setState({password:e})}},{key:"submit",value:function(e){e.preventDefault(),this.login(this.state.name,this.state.password)}},{key:"login",value:function(e,t){var a=this,n={name:e,password:t};this.setState({message:"Logging in"}),_({url:"/api/login",body:n,ok:function(e){var t=e.success,n=e.message;if(t){var r=document.location.search;if(r.length<=5)document.location.href="/";else{var c=r.substring(r.indexOf("=")+1);document.location.href=c}}else a.setState({message:n})},notok:function(){a.setState({message:"Connection to server failed, unable to continue."})}})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"container"},r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-offset-2 col-lg-5"},r.a.createElement("form",{className:"form-horizontal",onSubmit:function(t){return e.submit(t)}},r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-sm-offset-2 col-sm-10 text"},r.a.createElement("p",null,"\xa0",this.state.message))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label text"},"Handle"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{type:"text",className:"form-control",id:"handle",placeholder:"",autoFocus:!0,onChange:function(t){e.onNameChange(t.target.value)},value:this.state.name}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"inputPassword3",className:"col-sm-2 control-label text"},"Password"),r.a.createElement("div",{className:"col-sm-10"},r.a.createElement("input",{type:"password",className:"form-control",id:"password",placeholder:"Password",onChange:function(t){e.onPasswordChange(t.target.value)},value:this.state.password}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"col-sm-offset-2 col-sm-10"},r.a.createElement("button",{type:"submit",className:"btn btn-default"},"Sign in")))))),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),this.names.map(this.renderName))}}]),t}(n.Component),Qa=a(31),Za=function(e,t,a,n){return n===e.getDate()&&a===e.getMonth()&&t===e.getFullYear()},$a=function(e){var t=e.timestamp,a=new Date-t,n=Math.round(a%864e5%36e5/6e4);if(n<60)return r.a.createElement("span",null,n+" minutes ago");var c=t.getHours(),i=t.getMinutes();return r.a.createElement("span",null,function(e){var t=e.getDate(),a=e.getMonth(),n=e.getFullYear(),r=new Date;return Za(r,n,a,t)?"today":Za(r-1,n,a,t)?"yesterday":n+"-"+a+"-"+t}(t)," ",c,":",i)},en={"mail-1234-2144":{id:"mail-1234-2144",timestamp:new Date,read:!1,from:"overlord12",title:"scan for hiveboats-pradza.edu.gov",lines:[{type:"text",data:"Welcome to verdant technologies."},{type:"text",data:"This is your first email."},{type:"text",data:"Sure is exciting!."}]},"mail-2233-fd99":{id:"mail-2233-fd99",timestamp:new Date,read:!1,from:"system",title:"hardware error detected",lines:[{type:"text",data:"Welcome to verdant technologies."},{type:"text",data:"This is your second mail."},{type:"text",data:"The thrill of it ;)"}]}},tn=function(e,t){if(!e[t])return r.a.createElement("div",null," No mails selected");var a=e[t];return r.a.createElement("div",{className:"text"},"Date: ",r.a.createElement($a,{timestamp:a.timestamp}),r.a.createElement("br",null),"From: ",r.a.createElement("span",{className:"text-primary strong"},a.from),r.a.createElement("br",null),r.a.createElement("hr",null),a.lines.map(function(e){return r.a.createElement("div",null,e.data)}),r.a.createElement("br",null))},an=Object(h.b)(function(e){return{mails:en,currentMail:e.currentMail}},function(e){return{selectMail:function(t){e({type:"SELECT_MAIL",mailId:t})}}})(function(e){var t=e.mails,a=e.selectMail,n=e.currentMail,c=Object.keys(t).map(function(e,a){return t[e]});return r.a.createElement("span",null,r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-2"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("span",{className:"text"},"\xa0")))),r.a.createElement("div",{className:"col-lg-5"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12 backgroundLight"},r.a.createElement("span",{className:"text"},"\xa0"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"text"},r.a.createElement("br",null),r.a.createElement("div",null,"Mail"),r.a.createElement("br",null),tn(t,n))))),r.a.createElement("div",{className:"col-lg-5 rightPane rightPane"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("span",{className:"text"},"Mails"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"siteMap rightPaneDimensions"},r.a.createElement("div",null,"\xa0"),r.a.createElement("div",{className:"rightPanePadLeftRight"},r.a.createElement("div",{className:"siteMap rightPaneDimensions"},r.a.createElement("div",{className:"rightPanePadLeftRight"},r.a.createElement("table",{className:"table table-condensed text-muted text",id:"mails"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"strong"},"From"),r.a.createElement("td",{className:"strong"},"Title"),r.a.createElement("td",{className:"strong"},"Date"))),r.a.createElement("tbody",null,c.map(function(e){return r.a.createElement("tr",{key:e.id},r.a.createElement("td",{className:"table-very-condensed",style:{width:"85px"}},e.from),r.a.createElement("td",{className:"table-very-condensed",style:{width:"400px"}},r.a.createElement(N,{onClick:function(){a(e.id)}}," ",e.title)),r.a.createElement("td",{className:"table-very-condensed",style:{width:"122px"}},r.a.createElement($a,{timestamp:e.timestamp})))})))))))))))),r.a.createElement(S,null))}),nn="ENTER_SCAN",rn="SERVER_SITE_DISCOVERED",cn="SCAN_FOR_NAME",sn="RETRIEVE_USER_SCANS",on="DELETE_SCAN",ln=Object(h.b)(function(e){return{scans:e.home.scans}},function(e){return{scanSite:function(t){e({type:cn,siteName:t})},enterScan:function(t){e({type:nn,data:{scanId:t.scanId,siteId:t.siteId}})},deleteScan:function(t){e({type:on,scanId:t.scanId})}}})(function(e){var t=e.scanSite,a=e.scans,n=e.enterScan,c=e.deleteScan;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("div",{className:"row backgroundLight"},"\xa0"),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"text"},r.a.createElement("strong",null,"\ud83d\udf01 Verdant OS \ud83d\udf03"),r.a.createElement("br",null),r.a.createElement("br",null),"Choose site to investigate or attack",r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null)),r.a.createElement("div",{id:"actions"},r.a.createElement("div",{className:"text"},r.a.createElement(x,{placeholder:"Site name",buttonLabel:"Scan",buttonClass:"btn-info",save:function(e){return t(e)},clearAfterSubmit:"true"})),r.a.createElement("div",null,r.a.createElement(i.b,{to:"/scan/site-123",target:"_blank"},"Edit"))))),r.a.createElement("div",{className:"col-lg-6 rightPane"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("span",{className:"text"},"Scans"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"siteMap rightPaneDimensions"},r.a.createElement("div",null,"\xa0"),r.a.createElement("div",{className:"rightPanePadLeftRight"},r.a.createElement("table",{className:"table table-condensed text-muted text",id:"sitesTable"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"strong"},"Site Name"),r.a.createElement("td",{className:"strong"},"Complete"),r.a.createElement("td",{className:"strong"},"Scan ID"),r.a.createElement("td",{className:"strong"},"\xa0"))),r.a.createElement("tbody",null,a.map(function(e){return r.a.createElement("tr",{key:e.scanId},r.a.createElement("td",{className:"table-very-condensed"},r.a.createElement(N,{onClick:function(){n(e)}},e.siteName)),r.a.createElement("td",{className:"table-very-condensed"},e.complete?"yes":"no"),r.a.createElement("td",{className:"table-very-condensed"},e.scanId),r.a.createElement("td",{className:"table-very-condensed"},r.a.createElement(N,{onClick:function(){c(e)}},r.a.createElement("span",{className:"glyphicon glyphicon-remove-circle"}))))})))))))))}),un={help:{main:["u"],rest:"error s"},autoscan:{main:["u"],rest:"error s"},scan:{main:["u","ok"],rest:"error s"},dc:{main:["u"],rest:"error s"},"/share":{main:["u warn","info"],rest:"info"},hack:{main:["us","primary s"],rest:"error s"},passcode:{main:["us","primary s","warn s"],rest:"error s"}},dn=function(e){return e.split(" ").map(function(e){return"terminal_style_"+e}).join(" ")},mn=function(e,t,a){var n;return n=t>=a.main.length?dn(a.rest):dn(a.main[t]),r.a.createElement("span",{className:n,key:t},e)},hn=function(e){var t=e.input,a=e.prompt;return r.a.createElement("div",{className:"terminalLine terminal_input"},r.a.createElement("span",null,a),function(e){var t=e.split(" "),a=un[t[0]];if(!a&&!a)return r.a.createElement("span",{key:"1"},e);for(var n=t.map(function(e,t){return mn(e,t,a)}),c=[],i=0;i<n.length;i++)c.push(n[i]),i<n.length-1&&c.push(r.a.createElement("span",null,"\xa0"));return c}(t),r.a.createElement("span",{className:"terminalCaret"},"\xa0"))},vn=function(e){var t=e.line,a=e.index,n=t.class?t.class:[],c="terminalLine";n.forEach(function(e){c+=" terminal_"+e});var i=fn(t);return r.a.createElement("div",{className:c,key:a},i.map(function(e,t){return pn(e,t)}),"\xa0")},pn=function(e,t){return"text"===e.type?r.a.createElement("span",{className:e.className,key:t},e.text):r.a.createElement("span",{key:t},"\xa0")},fn=function(e){for(var t=[],a="text",n={text:"",className:"",type:"space"},r={text:"",className:"",type:"text"},c=Object(U.a)({},r),i="",s=0;s<e.data.length;s++){var o=e.data.charAt(s);if("["!==o){if(" "!==o||"text"!==a)if("]"!==o||"style"!==a)c.text+=o;else a="text",i=("/"===c.text?"":c.text).split(" ").map(function(e){return"terminal_style_"+e}).join(" "),c.text="";else c.text&&(c.className=i,t.push(c)),t.push(n),c=Object(U.a)({},r)}else{if("text"===a){a="style",c.text&&(c.className=i,t.push(c)),c=Object(U.a)({},r);continue}a="text",c.text+=o}}return"text"===a&&c.text&&(c.className=i,t.push(c)),t},En=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={},a.dispatch=null,a.bottomRef=r.a.createRef(),a.height="200px",a.state=Object(U.a)({},e.terminal),a.height=e.height,a.dispatch=e.dispatch,a.id=e.id,a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(U.a)({},e.terminal))}},{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"scrollToBottom",value:function(){this.bottomRef.current.scrollIntoView()}},{key:"renderLine",value:function(e,t){return r.a.createElement(vn,{line:e,index:t,key:t})}},{key:"renderRenderingLine",value:function(){return this.state.renderingLine?this.renderLine(this.state.renderingLine,"renderingLine"):r.a.createElement("div",null)}},{key:"renderInput",value:function(){return this.state.readonly?r.a.createElement("div",null):r.a.createElement(hn,{prompt:this.state.prompt,input:this.state.input})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"terminalPanel terminal_scrollbar",style:{height:this.height}},this.state.lines.map(function(t,a){return e.renderLine(t,a)}),this.renderRenderingLine(),this.renderInput(),r.a.createElement("div",{ref:this.bottomRef}))}}]),t}(n.Component),yn=function(){function e(t){Object(o.a)(this,e),this.queue=[],this.waitEnd=null,this.intervalId=null,this.active=!0,this.term=t,this.queue=[]}return Object(l.a)(e,[{key:"run",value:function(e,t){var a=this;this._schedule(function(){t(),a._setWait(e)})}},{key:"wait",value:function(e){this.active&&this.run(e,function(){})}},{key:"deactivate",value:function(){this.active=!1,this.queue=[],this.waitEnd=null}},{key:"_schedule",value:function(e){if(this.active){if(null===this.intervalId){var t=this;this.intervalId=setInterval(function(){t._mainLoop()},50)}this.queue.push(e)}}},{key:"_setWait",value:function(e){this.waitEnd=Date.now()+50*e}},{key:"_mainLoop",value:function(){if(null!=this.waitEnd){if(Date.now()<this.waitEnd)return;this.waitEnd=null}this.queue.length>0?(0,this.queue.splice(0,1)[0])():(clearInterval(this.intervalId),this.intervalId=null)}}]),e}(),bn=function(){function e(){Object(o.a)(this,e),this.threadsById={}}return Object(l.a)(e,[{key:"getOrCreateThread",value:function(e){if(this.threadsById[e])return this.threadsById[e];var t=new yn;return this.threadsById[e]=t,t}},{key:"deactivate",value:function(){var e=this;Object.keys(this.threadsById).forEach(function(t){e.threadsById[t].deactivate()})}}]),e}(),gn=20,Nn=function(){function e(t,a,n,r,c,i){var s=this;Object(o.a)(this,e),this.canvas=null,this.startNode=null,this.hackerIcon=null,this.labelIcon=null,this.thread=null,this.hacker=null,this.you=!1,this.startNodeDisplay=null,this.line=null,this.y=null,this.x=null,this.canvas=t,this.thread=a,this.hacker=r,this.startNodeDisplay=n;var l=document.getElementById(r.icon);this.x=c,this.y=790;var u=i?60:40;this.hackerIcon=new ke.fabric.Image(l,{left:this.x,top:this.y,height:u,width:u,opacity:0}),this.canvas.add(this.hackerIcon),ze(this.canvas,this.hackerIcon,"opacity",1,gn),this.hackerHider=new ke.fabric.Rect({left:this.x,top:this.y+25,height:35,width:40,opacity:1,fill:"#333333"}),this.canvas.add(this.hackerHider);var d=i?"You":r.userName;this.labelIcon=new ke.fabric.Text(d,{fill:"#f0ad4e",fontFamily:"courier",fontSize:12,fontStyle:"normal",left:this.x,top:this.y+15,textAlign:"center",opacity:0,selectable:!1}),this.canvas.add(this.labelIcon),ze(this.canvas,this.labelIcon,"opacity",1,gn);var m=Ge(this,n);this.lineIcon=new ke.fabric.Line(m.asArray(),{stroke:"#bb8",strokeWidth:2,strokeDashArray:[4,4],selectable:!1,hoverCursor:"default",opacity:0}),this.canvas.add(this.lineIcon),this.canvas.sendToBack(this.lineIcon),this.thread.run(3,function(){return ze(s.canvas,s.lineIcon,"opacity",.5,40)})}return Object(l.a)(e,[{key:"size",value:function(){return 30}},{key:"move",value:function(e){this.x=e,ze(this.canvas,this.hackerIcon,"left",e,gn),ze(this.canvas,this.hackerHider,"left",e,gn),ze(this.canvas,this.labelIcon,"left",e,gn),ze(this.canvas,this.hackerHider,"left",e,gn);var t=Ge(this,this.startNodeDisplay);ze(this.canvas,this.lineIcon,null,t.asCoordinates(),gn)}}]),e}(),In=function(){function e(t,a,n,r,c,i,s){var l=this,u=r.path,d=r.scanType,m=r.autoScan;Object(o.a)(this,e),this.canvas=null,this.dispatch=null,this.id=null,this.thread=null,this.autoScan=null,this.yourProbe=null,this.probeIcon=null,this.lineIcons=[],this.canvas=t,this.thread=a,this.autoScan=m,this.yourProbe=i,this.dispatch=n,this.padding=i?3:5;var h=Math.floor(10*Math.random())+1,v=document.getElementById("PROBE_"+h);this.probeIcon=new ke.fabric.Image(v,{left:c.x,top:c.y,height:40,width:40,opacity:0}),this.canvas.add(this.probeIcon),this.canvas.bringToFront(this.probeIcon);var p=c;u.forEach(function(e){var t=s[e];l.scheduleMoveStep(t,p),p=t});var f=u.pop();a.run(0,function(){l.processProbeArrive(d,f,p)})}return Object(l.a)(e,[{key:"scheduleMoveStep",value:function(e,t){var a=this;this.thread.run(22,function(){return a.moveStep(e,t,20)})}},{key:"moveStep",value:function(e,t,a){var n=this.createProbeLine(t,e);this.lineIcons.push(n);var r=Ge(t,e,this.padding);ze(this.canvas,n,null,r.asCoordinates(),a,Je)}},{key:"createProbeLine",value:function(e,t){var a=function(e,t,a,n){var r=Ke(e,t).distance;return qe(e,t,a,r-a,n)}(e,t,22,this.padding),n=new ke.fabric.Line(a.asArray(),{stroke:"#285ba0",strokeWidth:1,selectable:!1,hoverCursor:"default",opacity:1});return this.canvas.add(n),this.canvas.sendToBack(n),n}},{key:"processProbeArrive",value:function(e,t,a){switch(this.probeIcon.setLeft(a.x+5),this.probeIcon.setTop(a.y+5),e){case"SCAN_NODE_INITIAL":return this.scanInside(t,"SCAN_NODE_INITIAL");case"SCAN_CONNECTIONS":return this.scanOutside(t);case"SCAN_NODE_DEEP":return this.scanInside(t,"SCAN_NODE_DEEP");default:return this.probeError(e,t)}}},{key:"scanInside",value:function(e,t){var a=this;this.thread.run(50,function(){ze(a.canvas,a.probeIcon,"width","20",50),ze(a.canvas,a.probeIcon,"height","20",50),ze(a.canvas,a.probeIcon,"opacity","0.8",50)}),this.thread.run(25,function(){ze(a.canvas,a.probeIcon,"width","40",50),ze(a.canvas,a.probeIcon,"height","40",50),ze(a.canvas,a.probeIcon,"opacity","0.6",25)});this.finishProbe(function(){a.yourProbe&&a.dispatch({type:Le,nodeId:e,action:t})})}},{key:"scanOutside",value:function(e){var t=this;this.thread.run(50,function(){ze(t.canvas,t.probeIcon,"width","100",50),ze(t.canvas,t.probeIcon,"height","100",50),ze(t.canvas,t.probeIcon,"opacity","0.2",50)}),this.thread.run(25,function(){ze(t.canvas,t.probeIcon,"width","40",50),ze(t.canvas,t.probeIcon,"height","40",50),ze(t.canvas,t.probeIcon,"opacity","0.3",25)});this.finishProbe(function(){t.yourProbe&&t.dispatch({type:Le,nodeId:e,action:"SCAN_CONNECTIONS"})})}},{key:"finishProbe",value:function(e){var t=this;this.thread.run(10,function(){ze(t.canvas,t.probeIcon,"opacity","0",10),t.lineIcons.forEach(function(e){ze(t.canvas,e,"opacity","0",10)}),e()}),this.thread.run(10,function(){t.canvas.remove(t.probeIcon),t.lineIcons.forEach(function(e){t.canvas.remove(e)}),t.performAutoScan()})}},{key:"performAutoScan",value:function(){this.autoScan&&this.yourProbe&&this.dispatch({type:Pe})}},{key:"probeError",value:function(e,t){var a=this;this.thread.run(30,function(){ze(a.canvas,a.probeIcon,"height",0,30)}),this.thread.run(0,function(){a.dispatch({type:_e,data:"[warn b]Probe error: [info]"+e+"[/] unknown. nodeId: [info]"+t})})}},{key:"remove",value:function(){var e=this;this.canvas.remove(this.probeIcon),this.lineIcons.forEach(function(t){e.canvas.remove(t)})}}]),e}(),On=new(function(){function e(){Object(o.a)(this,e),this.nodeDataById=null,this.connectionDataById={},this.hackers=[],this.displayById={},this.dispatch=null,this.iconThread=new yn,this.probeThreads=new bn,this.startNodeDisplay=null,this.userId=null,this.canvas=null}return Object(l.a)(e,[{key:"init",value:function(e,t){this.userId=e,this.dispatch=t,this.canvas=new ke.fabric.StaticCanvas("scanCanvas",{width:607,height:815,backgroundColor:"#333333"}),ke.fabric.Object.prototype.originX="center",ke.fabric.Object.prototype.originY="center",this.canvas.selection=!1}},{key:"reset",value:function(){var e=this;null!==this.canvas&&(Object.keys(this.displayById).forEach(function(t){var a=e.displayById[t];e.canvas.remove(a)}),this.nodeDataById=null,this.connections=[],this.hackers=[],this.displayById={},this.connectionDataById={},this.startNodeDisplay=null,this.iconThread.deactivate(),this.probeThreads.deactivate(),this.iconThread=new yn,this.probeThreads=new bn,this.render())}},{key:"render",value:function(){this.canvas.renderAll()}},{key:"loadScan",value:function(e){var t=this,a=e.scan,n=e.site,r=e.hackers,c=n.nodes,i=n.connections;this.nodeDataById={},this.sortAndAddHackers(r),c.forEach(function(e){t.nodeDataById[e.id]=e;var n=a.nodeScanById[e.id];e.status=n.status,e.distance=n.distance}),this.connectionDataById={},i.forEach(function(e){t.connectionDataById[e.id]=e}),c.forEach(function(e){"UNDISCOVERED"!==e.status&&t.addNodeDisplay(e)}),i.forEach(function(e){var a=t.displayById[e.fromId],n=t.displayById[e.toId];a&&n&&t.addConnectionDisplay(e.id,a,n)}),this.startNodeDisplay=this.displayById[c[0].id],this.addHackersDisplays(this.startNodeDisplay)}},{key:"sortAndAddHackers",value:function(e){var t=this,a=e.find(function(e){return e.userId===t.userId}),n=e.filter(function(e){return e.userId!==t.userId});n.sort(function(e,t){return e.userName>t.userName?1:t.userName>e.userName?-1:0});var r=Math.floor(n.length/2);this.hackers=n,this.hackers.splice(r,0,a)}},{key:"addHackersDisplays",value:function(e){var t=this,a=Math.floor(607/(this.hackers.length+1));this.hackers.forEach(function(n,r){t.addHackerDisplay(n,e,a*(r+1))})}},{key:"addHackerDisplay",value:function(e,t,a){var n=e.userId===this.userId;this.displayById[e.userId]=new Nn(this.canvas,this.iconThread,t,e,a,n)}},{key:"addNodeDisplay",value:function(e){var t=new Xe(this.canvas,this.iconThread,e);this.displayById[e.id]=t,t.appear()}},{key:"addConnectionDisplay",value:function(e,t,a){var n=new Qe(this.canvas,this.iconThread,e,t,a);this.displayById[e]=n,n.appear()}},{key:"launchProbe",value:function(e){var t=this.probeThreads.getOrCreateThread(e.probeUserId),a=this.displayById[e.probeUserId],n=e.probeUserId===this.userId;this.displayById[e.id]=new In(this.canvas,t,this.dispatch,e,a,n,this.displayById)}},{key:"updateNodeStatus",value:function(e,t){this.displayById[e].updateStatus(t)}},{key:"discoverNodes",value:function(e,t){var a=this;e.forEach(function(e){var t=a.nodeDataById[e];t.status="DISCOVERED",a.addNodeDisplay(t)}),t.forEach(function(e){var t=a.connectionDataById[e],n=a.displayById[t.fromId],r=a.displayById[t.toId];a.addConnectionDisplay(t.id,n,r)})}},{key:"hackerEnter",value:function(e){var t=this;if(e.userId!==this.userId){this.hackers.length%2===0?this.hackers.splice(0,0,e):this.hackers.push(e);var a=Math.floor(607/(this.hackers.length+1));this.hackers.forEach(function(n,r){var c=a*(r+1);n.userId===e.userId?t.addHackerDisplay(n,t.startNodeDisplay,c):t.displayById[n.userId].move(c)})}}},{key:"hackerLeave",value:function(e){}}]),e}()),kn=Object(h.b)(function(e){return{theme:e.theme}},function(){return{}})(function(e){var t=e.theme,a=e.type,n=e.onLoad,c="/img/"+t+"/nodes/scan/",i=a.dir+"/"+a.name+".png",s=c+"empty.png",o=c+"type/"+i,l=c+"free/"+i,u=c+"protected/"+i,d=c+"hacked/"+i;return r.a.createElement("span",null,r.a.createElement("img",{src:s,height:"80",width:"80",id:a.name+"_DISCOVERED",onLoad:n}),r.a.createElement("img",{src:o,height:"80",width:"80",id:a.name+"_TYPE",onLoad:n}),r.a.createElement("img",{src:l,height:"80",width:"80",id:a.name+"_FREE",onLoad:n}),r.a.createElement("img",{src:u,height:"80",width:"80",id:a.name+"_PROTECTED",onLoad:n}),r.a.createElement("img",{src:d,height:"80",width:"80",id:a.name+"_HACKED",onLoad:n}))}),wn=Object(h.b)(function(e){return{theme:e.theme}},function(){return{}})(function(e){var t=e.theme,a=e.fileName,n=e.type,c=e.onLoad,i="/img/"+t+"/actors/hackers/"+a;return r.a.createElement("img",{src:i,height:"80",width:"80",id:n,onLoad:c})}),Sn=Object(h.b)(function(e){return{theme:e.theme}},function(){return{}})(function(e){var t="/img/"+e.theme+"/actors/scan_probes/"+"probe-";return r.a.createElement("span",null,[1,2,3,4,5,6,7,8,9,10].map(function(e){return function(e){return r.a.createElement("img",{src:t+e+".png",height:"80",width:"80",id:"PROBE_"+e,key:e})}(e)}))}),xn=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){On.init(this.props.userId,this.props.dispatch)}},{key:"allowDrop",value:function(e){e.preventDefault()}},{key:"render",value:function(){var e=function(){On.render()};return r.a.createElement("div",{id:"canvas-container"},r.a.createElement("canvas",{id:"scanCanvas",className:"siteMap"}),r.a.createElement("div",{className:"dontDisplay"},r.a.createElement(kn,{type:Y,onLoad:e}),r.a.createElement(kn,{type:J,onLoad:e}),r.a.createElement(kn,{type:X,onLoad:e}),r.a.createElement(kn,{type:Q,onLoad:e}),r.a.createElement(kn,{type:W,onLoad:e}),r.a.createElement(kn,{type:K,onLoad:e}),r.a.createElement(kn,{type:G,onLoad:e}),r.a.createElement(kn,{type:q,onLoad:e}),r.a.createElement(kn,{type:Z,onLoad:e}),r.a.createElement(kn,{type:$,onLoad:e}),r.a.createElement(kn,{type:ee,onLoad:e}),r.a.createElement(kn,{type:te,onLoad:e}),r.a.createElement(kn,{type:ae,ice:!0,onLoad:e}),r.a.createElement(kn,{type:ne,ice:!0,onLoad:e}),r.a.createElement(kn,{type:re,ice:!0,onLoad:e}),r.a.createElement(wn,{type:"BEAR",fileName:"animal-bear4-sc44.png",onLoad:e}),r.a.createElement(wn,{type:"BIRD_1",fileName:"animal-bird2.png",onLoad:e}),r.a.createElement(wn,{type:"CAT",fileName:"animal-cat3.png",onLoad:e}),r.a.createElement(wn,{type:"CRAB",fileName:"animal-crab2.png",onLoad:e}),r.a.createElement(wn,{type:"DINO_1",fileName:"animal-dinosaur3.png",onLoad:e}),r.a.createElement(wn,{type:"DINO_2",fileName:"animal-dinosaur4.png",onLoad:e}),r.a.createElement(wn,{type:"DRAGON_1",fileName:"animal-dragon1.png",onLoad:e}),r.a.createElement(wn,{type:"LION",fileName:"animal-lion1-sc36.png",onLoad:e}),r.a.createElement(wn,{type:"GECKO",fileName:"animal-lizard2-sc37.png",onLoad:e}),r.a.createElement(wn,{type:"LIZARD",fileName:"animal-lizard1.png",onLoad:e}),r.a.createElement(wn,{type:"LIONESS",fileName:"animal-lion3-sc37.png",onLoad:e}),r.a.createElement(wn,{type:"MONKEY",fileName:"animal-monkey.png",onLoad:e}),r.a.createElement(wn,{type:"COBRA",fileName:"animal-snake1.png",onLoad:e}),r.a.createElement(wn,{type:"LOBSTER_1",fileName:"animal-lobster.png",onLoad:e}),r.a.createElement(wn,{type:"SHARK",fileName:"animal-fish7-sc37.png",onLoad:e}),r.a.createElement(wn,{type:"STINGRAY",fileName:"animal-fish6.png",onLoad:e}),r.a.createElement(wn,{type:"FROG",fileName:"animal-frog.png",onLoad:e}),r.a.createElement(wn,{type:"BULL",fileName:"animal-bull1-sc44.png",onLoad:e}),r.a.createElement(wn,{type:"CROCODILE",fileName:"animal-crocodile-sc43.png",onLoad:e}),r.a.createElement(wn,{type:"DOG",fileName:"animal-dog5-sc44.png",onLoad:e}),r.a.createElement(wn,{type:"DRAGON_2",fileName:"animal-dragon5-sc28.png",onLoad:e}),r.a.createElement(wn,{type:"FISH_1",fileName:"animal-fish.png",onLoad:e}),r.a.createElement(wn,{type:"HIPPO",fileName:"animal-hippo3-sc22.png",onLoad:e}),r.a.createElement(wn,{type:"HORSE",fileName:"animal-horse1.png",onLoad:e}),r.a.createElement(wn,{type:"KOALA",fileName:"animal-koala-bear.png",onLoad:e}),r.a.createElement(wn,{type:"SEAHORSE",fileName:"animal-seahorse2-sc37.png",onLoad:e}),r.a.createElement(wn,{type:"SNAKE_2",fileName:"animal-snake.png",onLoad:e}),r.a.createElement(wn,{type:"UNICORN",fileName:"animal-unicorn.png",onLoad:e}),r.a.createElement(wn,{type:"WOLF",fileName:"animal-wolf-sc44.png",onLoad:e}),r.a.createElement(wn,{type:"TURTLE",fileName:"animal-turtle.png",onLoad:e}),r.a.createElement(wn,{type:"MOOSE",fileName:"animal-moose-sc44.png",onLoad:e}),r.a.createElement(wn,{type:"CAMEL",fileName:"animal-camel2-sc36.png",onLoad:e}),r.a.createElement(wn,{type:"EAGLE",fileName:"animal-bird4-sc44.png",onLoad:e}),r.a.createElement(wn,{type:"DINO_3",fileName:"animal-dinosaur1.png",onLoad:e}),r.a.createElement(wn,{type:"DRAGON_3",fileName:"animal-dragon2.png",onLoad:e}),r.a.createElement(wn,{type:"ELEPHANT",fileName:"animal-elephant1.png",onLoad:e}),r.a.createElement(wn,{type:"FISH_2",fileName:"animal-fish13.png",onLoad:e}),r.a.createElement(wn,{type:"LOBSTER_2",fileName:"animal-lobster1-sc44.png",onLoad:e}),r.a.createElement(wn,{type:"CAT_2",fileName:"animal-cat1.png",onLoad:e}),r.a.createElement(wn,{type:"BIRD_2",fileName:"animal-bird.png",onLoad:e}),r.a.createElement(wn,{type:"NOT",fileName:"animal-cat-print.png",onLoad:e}),r.a.createElement(Sn,null)))}}]),t}(n.Component),_n=Object(Qa.a)(function(e){return{userId:e.userId}},function(e){return{dispatch:e}})(xn),jn=Object(h.b)(function(e){return{terminal:e.terminal,messageTerminal:e.scan.messageTerminal}},function(e){return{dispatch:e}})(function(e){var t=e.terminal,a=(e.messageTerminal,e.dispatch);return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-6"},r.a.createElement("div",{className:"row backgroundLight"},"\xa0"),r.a.createElement("div",{className:"row"},r.a.createElement(En,{terminal:t,dispatch:a,height:"780px"}))),r.a.createElement("div",{className:"col-lg-6 rightPane"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("span",{className:"text"},"Scans"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(_n,null)))))}),Cn=Object(Qa.a)(function(e){return{messageTerminal:e.scan.messageTerminal,currentPage:e.currentPage}},function(e){return{dispatch:e}})(function(e){var t=e.currentPage,a=e.messageTerminal,n=e.dispatch;return r.a.createElement("span",null,r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-2"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("span",{className:"text"},"\xa0"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(En,{terminal:a,dispatch:n,height:"300px"})))),r.a.createElement("div",{className:"col-lg-10"},function(e){switch(e){case"MAIL":return r.a.createElement(an,null);case w:return r.a.createElement(jn,null);default:return r.a.createElement(ln,null)}}(t)))),r.a.createElement(S,null))}),Dn=Tt.a.mark(An),Rn=Tt.a.mark(Pn),Ln=Tt.a.mark(Bn);function An(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return On.launchProbe(e.data),void(t.next=3);case 3:case"end":return t.stop()}},Dn)}var Tn=function(e){return e.scan.scan.id};function Pn(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(Tn);case 2:return t=r.sent,a={scanId:t,nodeId:e.nodeId,action:e.action},n=JSON.stringify(a),Ve.send("/av/scan/probeArrive",n),void(r.next=8);case 8:case"end":return r.stop()}},Rn)}function Bn(){var e;return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Pt.c)(Tn);case 2:return e=t.sent,Ve.send("/av/scan/autoScan",e),void(t.next=6);case 6:case"end":return t.stop()}},Ln)}var Mn=Tt.a.mark(Vn),Fn=Tt.a.mark(Hn);function Vn(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.data,a=t.nodeId,n=t.newStatus,On.updateNodeStatus(a,n),void(r.next=4);case 4:case"end":return r.stop()}},Mn)}function Hn(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.data,a=t.nodeIds,n=t.connectionIds,On.discoverNodes(a,n),void(r.next=4);case 4:case"end":return r.stop()}},Fn)}var Un=Tt.a.mark(Gn),zn=Tt.a.mark(qn),Wn=function(e){return e.scan.scan.id},Kn=function(e){return e.currentPage};function Gn(e){var t,a,n;return Tt.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Pt.c)(Wn);case 2:return t=r.sent,a={scanId:t,command:e.command},n=JSON.stringify(a),Ve.send("/av/scan/terminal",n),void(r.next=8);case 8:case"end":return r.stop()}},Un)}function qn(){var e;return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Pt.c)(Kn);case 2:return e=t.sent,t.next=5,Object(Pt.b)({type:f,to:k,from:e});case 5:case"end":return t.stop()}},zn)}var Yn=new(function(){function e(){Object(o.a)(this,e),this.store=null,this.dispatch=null,this.terminalTickIntervalId=null,this.running=!1}return Object(l.a)(e,[{key:"init",value:function(e){var t=this;this.store=e,this.dispatch=e.dispatch,this.terminalTickIntervalId=setInterval(function(){t.dispatch({type:"TERMINAL_TICK"})},10),window.onkeydown=function(e){t.running&&t.handleKeyDown(e)}}},{key:"start",value:function(){this.running=!0}},{key:"stop",value:function(){this.running=!1}},{key:"handleKeyDown",value:function(e){var t=e.keyCode,a=e.key;t>=113&&t<=123||(e.preventDefault(),13===t?this.dispatch({type:xe,key:a,command:this.store.getState().terminal.input,terminalId:"main"}):this.dispatch({type:"TERMINAL_KEY_PRESS",key:a,keyCode:t,terminalId:"main"}))}}]),e}()),Jn=Tt.a.mark(rr),Xn=Tt.a.mark(cr),Qn=Tt.a.mark(ir),Zn=Tt.a.mark(sr),$n=Tt.a.mark(or),er=Tt.a.mark(lr),tr=Tt.a.mark(ur),ar=Tt.a.mark(dr),nr=function(e){return e.currentPage};function rr(){return Tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ve.send("/av/scan/scansOfPlayer",""),void(e.next=3);case 3:case"end":return e.stop()}},Jn)}function cr(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Ve.send("/av/scan/scanForName",e.siteName),void(t.next=3);case 3:case"end":return t.stop()}},Xn)}function ir(e){var t,a,n,r;return Tt.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.data,a=t.scanId,n=t.siteId,c.next=3,Object(Pt.c)(nr);case 3:return r=c.sent,Ve.waitFor(De,Fe),Ve.subscribeForScan(a,n),On.reset(),c.next=9,Object(Pt.b)({type:je,terminalId:"main"});case 9:return c.next=11,Object(Pt.b)({type:f,to:w,from:r});case 11:return Ve.send("/av/scan/enterScan",a),Yn.start(),void(c.next=15);case 15:case"end":return c.stop()}},Qn)}function sr(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Ve.send("/av/scan/deleteScan",e.scanId),void(t.next=3);case 3:case"end":return t.stop()}},Zn)}function or(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return On.loadScan(e.data),void(t.next=3);case 3:case"end":return t.stop()}},$n)}function lr(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.from===w&&e.to!==w&&(Ve.unsubscribe(),Yn.stop()),void(t.next=3);case 3:case"end":return t.stop()}},er)}function ur(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return On.hackerEnter(e.data),void(t.next=3);case 3:case"end":return t.stop()}},tr)}function dr(e){return Tt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return On.hackerLeave(e.data),void(t.next=3);case 3:case"end":return t.stop()}},ar)}var mr=function(){var e=Tt.a.mark(a),t=Tt.a.mark(n);function a(){return Tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Pt.d)(E,ha);case 2:return e.next=4,Object(Pt.d)(b,va);case 4:return e.next=6,Object(Pt.d)(g,pa);case 6:return e.next=8,Object(Pt.d)(y,fa);case 8:return e.next=10,Object(Pt.d)(f,lr);case 10:return e.next=12,Object(Pt.d)(Ce,qn);case 12:return e.next=14,Object(Pt.d)(sn,rr);case 14:return e.next=16,Object(Pt.d)(cn,cr);case 16:return e.next=18,Object(Pt.d)(on,sr);case 18:return e.next=20,Object(Pt.d)(nn,ir);case 20:return e.next=22,Object(Pt.d)(rn,ir);case 22:return e.next=24,Object(Pt.d)(De,or);case 24:return e.next=26,Object(Pt.d)(xe,Gn);case 26:return e.next=28,Object(Pt.d)(Ae,Vn);case 28:return e.next=30,Object(Pt.d)(Te,Hn);case 30:return e.next=32,Object(Pt.d)(Re,An);case 32:return e.next=34,Object(Pt.d)(Le,Pn);case 34:return e.next=36,Object(Pt.d)(Pe,Bn);case 36:return e.next=38,Object(Pt.d)(Be,ur);case 38:return e.next=40,Object(Pt.d)(Me,dr);case 40:case"end":return e.stop()}},e)}function n(){return Tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Pt.a)([a()]);case 2:case"end":return e.stop()}},t)}return n},hr=[],vr=Object(P.c)({scans:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SERVER_RECEIVE_USER_SCANS":return t.data;default:return e}}}),pr={"mail-1234-2144":{id:"mail-1234-2144",timestamp:new Date,read:!1,from:"overlord12",title:"scan for hiveboats-pradza.edu.gov",lines:[{type:"text",data:"Welcome to verdant technologies."},{type:"text",data:"This is your first email."},{type:"text",data:"Sure is exciting!."}]},"mail-2233-fd99":{id:"mail-2233-fd99",timestamp:new Date,read:!1,from:"system",title:"hardware error detected",lines:[{type:"text",data:"Welcome to verdant technologies."},{type:"text",data:"This is your second mail."},{type:"text",data:"The thrill of it ;)"}]}},fr=Object(P.c)({mails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pr;return(arguments.length>1?arguments[1]:void 0).type,e},currentMail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_MAIL":return t.mailId;default:return e}}}),Er={},yr={lines:[],prompt:"\u21cb ",readonly:!1,input:"",renderingLine:null,receivingLine:null,receiveBuffer:[{type:"text",data:"[b]\ud83d\udf01 Verdant OS \ud83d\udf03"},{type:"text",data:" "}],receiving:!0};function br(e){if(!e.receiving)return e;if(null===e.receivingLine&&0===e.receiveBuffer.length)return Object(U.a)({},e,{receiving:!1});var t,a=Object(ot.a)(e.receiveBuffer),n=Object(ot.a)(e.lines),r=e.renderingLine?Object(U.a)({},e.renderingLine):{type:"text",data:""};null!==e.receivingLine?t=Object(U.a)({},e.receivingLine):(t=Object(U.a)({},a[0]),a=Object(ot.a)(e.receiveBuffer).splice(1));var c=t.data,i=c.substr(0,1),s=c.substr(1);t.data=s,r.data+=i;var o=!0;return 0===t.data.length&&(n=wr([].concat(Object(ot.a)(e.lines),[r])),r=null,t=null,0===a.length&&(o=!1)),Object(U.a)({},e,{renderingLine:r,receivingLine:t,lines:n,receiving:o,receiveBuffer:a})}var gr=function(e,t){if(t.terminalId!==e.id)return e;var a=e.receiveBuffer?e.receiveBuffer:[],n={type:"text",data:t.data};return Object(U.a)({},e,{receiving:!0,receiveBuffer:[].concat(Object(ot.a)(a),[n])})},Nr=function(e,t){if(t.data.terminalId!==e.id)return e;var a=t.data.lines.map(function(e){return{type:"text",data:e}}),n=e.receiveBuffer?e.receiveBuffer:[];return Object(U.a)({},e,{receiving:!0,receiveBuffer:[].concat(Object(ot.a)(n),Object(ot.a)(a))})},Ir=function(e,t){var a=t.keyCode,n=t.key,r=Or(e.input,a,n);return Object(U.a)({},e,{input:r})},Or=function(e,t,a){return 8===t&&e.length>0?e.substr(0,e.length-1):9===t?e+"[t]":1===a.length?e+a:e},kr=function(e,t){if(t.terminalId!==e.id)return e;var a=e.prompt+t.command,n=wr([].concat(Object(ot.a)(e.lines),[{type:"text",data:a,class:["input"]}]));return Object(U.a)({},e,{lines:n,input:"",receiving:!0})},wr=function(e){for(;e.length>100;)e.shift();return e},Sr=function(e,t){var a=t.data.recoverable?[{type:"text",data:" "},{type:"text",data:"[warn b]A server error occurred. Please refresh browser."}]:[{type:"text",data:" "},{type:"text",data:"[warn b]A fatal server error occurred."}],n=[{type:"text",data:" "},{type:"text",data:"Details: "+t.data.message}];return Object(U.a)({},e,{input:"",receiveInput:null,receiveBuffer:[].concat(Object(ot.a)(e.receiveBuffer),a,n),receiving:!0,readonly:!0})};var xr=function(e,t){var a=Object(U.a)({},yr,t,{id:e});return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TERMINAL_TICK":return br(br(br(br(e))));case _e:return gr(e,t);case"SERVER_TERMINAL_RECEIVE":return Nr(e,t);case"TERMINAL_KEY_PRESS":return Ir(e,t);case xe:return kr(e,t);case y:return Sr(e,t);case je:return function(e,t,a){return t.terminalId===e.id?a:e}(e,t,a);default:return e}}},_r={},jr=Object(P.c)({messageTerminal:xr("chat",{readonly:!0,receiveBuffer:[{type:"text",data:"= chat online ="}]}),site:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_r,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case De:return t.data.site;default:return e}},scan:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Er,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case De:return t.data.scan;default:return e}}}),Cr={id:null},Dr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER_ID":return t.userId;default:return e}},Rr={},Lr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case De:return t.data.hackers;default:return e}},Ar=Object(P.c)({currentPage:B,scan:jr,home:vr,mail:fr,hackers:Lr,terminal:xr("main",{}),theme:Ra,userId:Dr}),Tr=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).init(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"init",value:function(){var e=this,t={currentPage:k},a=Object(Da.a)(),n=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||P.d;this.store=Object(P.e)(Ar,t,n(Object(P.a)(a))),Ve.create(this.store,function(){e.store.dispatch({type:sn})});var r=mr();a.run(r),Yn.init(this.store)}},{key:"renderIfAuthenticated",value:function(){return r.a.createElement(h.a,{store:this.store},r.a.createElement(Cn,null))}},{key:"render",value:function(){return r.a.createElement(T,{requires:"ROLE_HACKER"},this.renderIfAuthenticated())}}]),t}(n.Component);Object(c.render)(r.a.createElement(i.a,null,r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/login",component:Xa}),r.a.createElement(s.a,{path:"/hacker",component:Tr}),r.a.createElement(s.a,{path:"/gm",component:H}),r.a.createElement(s.a,{path:"/edit/:siteId?",component:Ya}),r.a.createElement(s.a,{path:"/",render:function(e){var t=p.a.get("type");"ADMIN"!==t?"GM"!==t?"HACKER"!==t&&"HACKER_MANAGER"!==t?(console.log("Unknown user type: "+t),p.a.remove("jwt"),p.a.remove("type"),p.a.remove("roles"),window.document.location.href="/login"):window.document.location.href="/hacker/":window.document.location.href="/gm/":window.document.location.href="/gm/admin"}}))),document.getElementById("root"))},44:function(e,t){},66:function(e,t,a){e.exports=a(105)},78:function(e,t){},79:function(e,t){},87:function(e,t){},89:function(e,t){},98:function(e,t){}},[[66,1,2]]]);
//# sourceMappingURL=main.e1b44ca1.chunk.js.map